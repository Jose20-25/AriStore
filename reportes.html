<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AriStore - Reportes y An치lisis</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="styles.css" rel="stylesheet">
    <!-- Chart.js para gr치ficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- jsPDF para exportaci칩n -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo-container">
                <img src="logos/aristore.png" alt="AriStore Logo" class="logo">
                <div>
                    <h1>AriStore</h1>
                    <p>M칩dulo de Reportes - An치lisis y M칠tricas</p>
                </div>
            </div>
            
            <!-- Barra de Navegaci칩n -->
            <div class="navbar">
                <a href="index.html" class="nav-item">
                    <i class="nav-icon fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
                <a href="inventario.html" class="nav-item">
                    <i class="nav-icon inventory fas fa-boxes"></i>
                    <span>Inventario</span>
                </a>
                <a href="ventas.html" class="nav-item">
                    <i class="nav-icon sales fas fa-cash-register"></i>
                    <span>Ventas</span>
                </a>
                <a href="clientes.html" class="nav-item">
                    <i class="nav-icon customers fas fa-users"></i>
                    <span>Clientes</span>
                </a>
                <a href="proveedores.html" class="nav-item">
                    <i class="nav-icon suppliers fas fa-truck"></i>
                    <span>Proveedores</span>
                </a>
                <a href="#" class="nav-item active">
                    <i class="nav-icon reports fas fa-chart-bar"></i>
                    <span>Reportes</span>
                </a>
                <a href="configuracion.html" class="nav-item">
                    <i class="nav-icon settings fas fa-cog"></i>
                    <span>Configuraci칩n</span>
                </a>
            </div>
        </div>

        <!-- Acciones R치pidas -->
        <div class="quick-actions-header">
            <button class="btn btn-secondary" onclick="refreshReports()">
                <i class="fas fa-sync-alt"></i>
                Actualizar
            </button>
            <button class="btn" onclick="exportAllReports()">
                <i class="fas fa-download"></i>
                Exportar Todo
            </button>
        </div>

        <!-- Per칤odo de An치lisis -->
        <div class="period-selector">
            <div class="period-title">
                <i class="fas fa-calendar"></i>
                Per칤odo de An치lisis
            </div>
            <div class="period-buttons">
                <button class="period-btn active" data-period="7" onclick="changePeriod(7)">칔ltima Semana</button>
                <button class="period-btn" data-period="30" onclick="changePeriod(30)">칔ltimo Mes</button>
                <button class="period-btn" data-period="90" onclick="changePeriod(90)">칔ltimos 3 Meses</button>
                <button class="period-btn" data-period="365" onclick="changePeriod(365)">칔ltimo A침o</button>
            </div>
        </div>

        <!-- M칠tricas Principales -->
        <div class="metrics-grid">
            <div class="metric-card revenue">
                <div class="metric-icon">
                    <i class="fas fa-dollar-sign"></i>
                </div>
                <div class="metric-content">
                    <div class="metric-value" id="totalRevenue">$12,450</div>
                    <div class="metric-label">Ingresos Totales</div>
                    <div class="metric-change positive">
                        <i class="fas fa-arrow-up"></i>
                        +15.3%
                    </div>
                </div>
            </div>
            <div class="metric-card profit">
                <div class="metric-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="metric-content">
                    <div class="metric-value" id="totalProfit">$4,680</div>
                    <div class="metric-label">Ganancia Neta</div>
                    <div class="metric-change positive">
                        <i class="fas fa-arrow-up"></i>
                        +12.8%
                    </div>
                </div>
            </div>
            <div class="metric-card sales">
                <div class="metric-icon">
                    <i class="fas fa-shopping-cart"></i>
                </div>
                <div class="metric-content">
                    <div class="metric-value" id="totalSales">156</div>
                    <div class="metric-label">Ventas Realizadas</div>
                    <div class="metric-change positive">
                        <i class="fas fa-arrow-up"></i>
                        +8.7%
                    </div>
                </div>
            </div>
            <div class="metric-card average">
                <div class="metric-icon">
                    <i class="fas fa-receipt"></i>
                </div>
                <div class="metric-content">
                    <div class="metric-value" id="avgTicket">$79.81</div>
                    <div class="metric-label">Ticket Promedio</div>
                    <div class="metric-change positive">
                        <i class="fas fa-arrow-up"></i>
                        +6.2%
                    </div>
                </div>
            </div>
        </div>

        <!-- Contenido Principal -->
        <div class="reports-content">
            <!-- Columna Izquierda -->
            <div class="reports-main">
                <!-- Gr치fico de Ventas -->
                <div class="report-card">
                    <div class="report-header">
                        <div class="report-title">
                            <i class="fas fa-chart-area"></i>
                            Tendencia de Ventas
                        </div>
                        <button class="export-btn" onclick="exportChart('salesTrendChart')">
                            <i class="fas fa-download"></i>
                        </button>
                    </div>
                    <div class="chart-container">
                        <canvas id="salesTrendChart"></canvas>
                    </div>
                </div>

                <!-- Productos M치s Vendidos -->
                <div class="report-card">
                    <div class="report-header">
                        <div class="report-title">
                            <i class="fas fa-trophy"></i>
                            Top 10 Productos M치s Vendidos
                        </div>
                        <button class="export-btn" onclick="exportTopProducts()">
                            <i class="fas fa-download"></i>
                        </button>
                    </div>
                    <div class="top-products-list" id="topProductsList">
                        <!-- Se llenar치 din치micamente -->
                    </div>
                </div>

                <!-- An치lisis de Categor칤as -->
                <div class="report-card">
                    <div class="report-header">
                        <div class="report-title">
                            <i class="fas fa-chart-pie"></i>
                            Distribuci칩n por Categor칤as
                        </div>
                        <button class="export-btn" onclick="exportChart('categoryChart')">
                            <i class="fas fa-download"></i>
                        </button>
                    </div>
                    <div class="chart-container" style="height: 300px;">
                        <canvas id="categoryChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Columna Derecha -->
            <div class="reports-sidebar">
                <!-- Alertas de Inventario -->
                <div class="report-card alert-card">
                    <div class="report-header">
                        <div class="report-title">
                            <i class="fas fa-exclamation-triangle"></i>
                            Alertas de Inventario
                        </div>
                    </div>
                    <div id="inventoryAlerts">
                        <!-- Se llenar치 din치micamente -->
                    </div>
                </div>

                <!-- An치lisis de Clientes -->
                <div class="report-card">
                    <div class="report-header">
                        <div class="report-title">
                            <i class="fas fa-users"></i>
                            An치lisis de Clientes
                        </div>
                        <button class="export-btn" onclick="exportCustomerAnalysis()">
                            <i class="fas fa-download"></i>
                        </button>
                    </div>
                    <div class="customer-stats">
                        <div class="customer-stat">
                            <div class="stat-icon">
                                <i class="fas fa-user-plus"></i>
                            </div>
                            <div>
                                <div class="stat-number" id="newCustomers">23</div>
                                <div class="stat-label">Nuevos Clientes</div>
                            </div>
                        </div>
                        <div class="customer-stat">
                            <div class="stat-icon">
                                <i class="fas fa-crown"></i>
                            </div>
                            <div>
                                <div class="stat-number" id="vipCustomers">12</div>
                                <div class="stat-label">Clientes VIP</div>
                            </div>
                        </div>
                        <div class="customer-stat">
                            <div class="stat-icon">
                                <i class="fas fa-sync-alt"></i>
                            </div>
                            <div>
                                <div class="stat-number" id="returningCustomers">87%</div>
                                <div class="stat-label">Clientes Recurrentes</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Rendimiento por D칤a -->
                <div class="report-card">
                    <div class="report-header">
                        <div class="report-title">
                            <i class="fas fa-calendar-day"></i>
                            Rendimiento por D칤a de la Semana
                        </div>
                        <button class="export-btn" onclick="exportChart('weeklyChart')">
                            <i class="fas fa-download"></i>
                        </button>
                    </div>
                    <div class="chart-container" style="height: 250px;">
                        <canvas id="weeklyChart"></canvas>
                    </div>
                </div>

                <!-- Comparaci칩n de Proveedores -->
                <div class="report-card">
                    <div class="report-header">
                        <div class="report-title">
                            <i class="fas fa-truck"></i>
                            Rendimiento de Proveedores
                        </div>
                        <button class="export-btn" onclick="exportSupplierAnalysis()">
                            <i class="fas fa-download"></i>
                        </button>
                    </div>
                    <div id="supplierPerformance">
                        <!-- Se llenar치 din치micamente -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Reportes R치pidos -->
        <div class="quick-reports">
            <div class="quick-reports-title">
                <i class="fas fa-flash"></i>
                Reportes R치pidos
            </div>
            <div class="quick-reports-grid">
                <button class="quick-report-btn" onclick="generateDailyReport()">
                    <i class="fas fa-calendar-day"></i>
                    <span>Reporte Diario</span>
                </button>
                <button class="quick-report-btn" onclick="generateWeeklyReport()">
                    <i class="fas fa-calendar-week"></i>
                    <span>Reporte Semanal</span>
                </button>
                <button class="quick-report-btn" onclick="generateMonthlyReport()">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Reporte Mensual</span>
                </button>
                <button class="quick-report-btn" onclick="generateInventoryReport()">
                    <i class="fas fa-boxes"></i>
                    <span>Estado de Inventario</span>
                </button>
                <button class="quick-report-btn" onclick="generateSalesReport()">
                    <i class="fas fa-chart-line"></i>
                    <span>An치lisis de Ventas</span>
                </button>
                <button class="quick-report-btn" onclick="generateCustomerReport()">
                    <i class="fas fa-users"></i>
                    <span>Reporte de Clientes</span>
                </button>
                <button class="quick-report-btn" onclick="generateSupplierReport()">
                    <i class="fas fa-truck"></i>
                    <span>An치lisis Proveedores</span>
                </button>
                <button class="quick-report-btn" onclick="generateProfitReport()">
                    <i class="fas fa-dollar-sign"></i>
                    <span>An치lisis de Rentabilidad</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentPeriod = 7;
        let salesTrendChart, categoryChart, weeklyChart;

        // Inicializar la p치gina
        document.addEventListener('DOMContentLoaded', function() {
            loadReportsData();
            initializeCharts();
            updateMetrics();
            loadTopProducts();
            loadInventoryAlerts();
            loadCustomerAnalysis();
            loadSupplierPerformance();
        });

        // Cargar datos para reportes
        function loadReportsData() {
            // Obtener datos de localStorage
            const products = JSON.parse(localStorage.getItem('aristore_products') || '[]');
            const sales = JSON.parse(localStorage.getItem('aristore_sales') || '[]');
            const clients = JSON.parse(localStorage.getItem('aristore_clients') || '[]');
            const suppliers = JSON.parse(localStorage.getItem('aristore_suppliers') || '[]');

            // Simular datos si no existen
            if (sales.length === 0) {
                generateSampleSalesData();
            }
        }

        // Generar datos de ejemplo para las ventas
        function generateSampleSalesData() {
            const sampleSales = [];
            const today = new Date();
            
            for (let i = 0; i < 30; i++) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                
                const numSales = Math.floor(Math.random() * 8) + 2;
                for (let j = 0; j < numSales; j++) {
                    sampleSales.push({
                        id: `SALE-${1000 + i * 10 + j}`,
                        date: date.toISOString(),
                        total: Math.random() * 200 + 20,
                        items: [
                            {
                                name: ['Auriculares Bluetooth', 'Cargador Inal치mbrico', 'Funda iPhone', 'Cable USB-C', 'Powerbank'][Math.floor(Math.random() * 5)],
                                quantity: Math.floor(Math.random() * 3) + 1,
                                price: Math.random() * 100 + 10
                            }
                        ],
                        customer: 'Cliente ' + (Math.floor(Math.random() * 100) + 1)
                    });
                }
            }
            
            localStorage.setItem('aristore_sales', JSON.stringify(sampleSales));
        }

        // Cambiar per칤odo de an치lisis
        function changePeriod(days) {
            currentPeriod = days;
            
            // Actualizar botones
            document.querySelectorAll('.period-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-period="${days}"]`).classList.add('active');
            
            // Actualizar datos
            updateMetrics();
            updateCharts();
        }

        // Actualizar m칠tricas
        function updateMetrics() {
            const sales = JSON.parse(localStorage.getItem('aristore_sales') || '[]');
            const cutoffDate = new Date();
            cutoffDate.setDate(cutoffDate.getDate() - currentPeriod);
            
            const periodSales = sales.filter(sale => new Date(sale.date) >= cutoffDate);
            
            const totalRevenue = periodSales.reduce((sum, sale) => sum + sale.total, 0);
            const totalSalesCount = periodSales.length;
            const avgTicket = totalSalesCount > 0 ? totalRevenue / totalSalesCount : 0;
            const totalProfit = totalRevenue * 0.375; // Estimaci칩n del 37.5% de margen
            
            // Actualizar elementos
            document.getElementById('totalRevenue').textContent = `$${totalRevenue.toLocaleString('es-ES', {minimumFractionDigits: 2})}`;
            document.getElementById('totalProfit').textContent = `$${totalProfit.toLocaleString('es-ES', {minimumFractionDigits: 2})}`;
            document.getElementById('totalSales').textContent = totalSalesCount;
            document.getElementById('avgTicket').textContent = `$${avgTicket.toFixed(2)}`;
        }

        // Inicializar gr치ficos
        function initializeCharts() {
            initSalesTrendChart();
            initCategoryChart();
            initWeeklyChart();
        }

        // Gr치fico de tendencia de ventas
        function initSalesTrendChart() {
            const ctx = document.getElementById('salesTrendChart').getContext('2d');
            const sales = JSON.parse(localStorage.getItem('aristore_sales') || '[]');
            
            // Procesar datos por d칤as
            const salesByDay = {};
            const cutoffDate = new Date();
            cutoffDate.setDate(cutoffDate.getDate() - currentPeriod);
            
            sales.filter(sale => new Date(sale.date) >= cutoffDate).forEach(sale => {
                const date = new Date(sale.date).toDateString();
                salesByDay[date] = (salesByDay[date] || 0) + sale.total;
            });
            
            const labels = Object.keys(salesByDay).sort().slice(-14);
            const data = labels.map(date => salesByDay[date] || 0);
            
            salesTrendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels.map(date => new Date(date).toLocaleDateString('es-ES', { month: 'short', day: 'numeric' })),
                    datasets: [{
                        label: 'Ventas Diarias',
                        data: data,
                        borderColor: '#4ecdc4',
                        backgroundColor: 'rgba(78, 205, 196, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#4ecdc4',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)',
                                callback: function(value) {
                                    return '$' + value.toFixed(0);
                                }
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        }
                    }
                }
            });
        }

        // Gr치fico de categor칤as
        function initCategoryChart() {
            const ctx = document.getElementById('categoryChart').getContext('2d');
            
            categoryChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Auriculares', 'Cargadores', 'Fundas', 'Cables', 'Otros'],
                    datasets: [{
                        data: [35, 25, 20, 15, 5],
                        backgroundColor: [
                            '#ff6b6b',
                            '#4ecdc4',
                            '#45b7d1',
                            '#f9ca24',
                            '#6c5ce7'
                        ],
                        borderWidth: 0,
                        hoverOffset: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: 'rgba(255, 255, 255, 0.8)',
                                font: {
                                    family: 'Inter',
                                    size: 12
                                },
                                padding: 15,
                                usePointStyle: true
                            }
                        }
                    },
                    cutout: '60%'
                }
            });
        }

        // Gr치fico semanal
        function initWeeklyChart() {
            const ctx = document.getElementById('weeklyChart').getContext('2d');
            
            weeklyChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Lun', 'Mar', 'Mi칠', 'Jue', 'Vie', 'S치b', 'Dom'],
                    datasets: [{
                        label: 'Ventas por D칤a',
                        data: [850, 1200, 900, 1100, 1400, 1600, 800],
                        backgroundColor: 'rgba(78, 205, 196, 0.8)',
                        borderColor: '#4ecdc4',
                        borderWidth: 2,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)',
                                callback: function(value) {
                                    return '$' + value;
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        }
                    }
                }
            });
        }

        // Actualizar gr치ficos
        function updateCharts() {
            if (salesTrendChart) {
                salesTrendChart.destroy();
                initSalesTrendChart();
            }
        }

        // Cargar productos m치s vendidos
        function loadTopProducts() {
            const sales = JSON.parse(localStorage.getItem('aristore_sales') || '[]');
            const productSales = {};
            
            sales.forEach(sale => {
                sale.items.forEach(item => {
                    if (productSales[item.name]) {
                        productSales[item.name].quantity += item.quantity;
                        productSales[item.name].revenue += item.price * item.quantity;
                    } else {
                        productSales[item.name] = {
                            quantity: item.quantity,
                            revenue: item.price * item.quantity
                        };
                    }
                });
            });
            
            const topProducts = Object.entries(productSales)
                .sort((a, b) => b[1].quantity - a[1].quantity)
                .slice(0, 10);
            
            const container = document.getElementById('topProductsList');
            container.innerHTML = topProducts.map((product, index) => `
                <div class="top-product-item">
                    <div class="product-rank">${index + 1}</div>
                    <div class="product-info">
                        <div class="product-name">${product[0]}</div>
                        <div class="product-sales">${product[1].quantity} vendidos</div>
                    </div>
                    <div class="product-revenue">$${product[1].revenue.toFixed(2)}</div>
                </div>
            `).join('');
        }

        // Cargar alertas de inventario
        function loadInventoryAlerts() {
            const products = JSON.parse(localStorage.getItem('aristore_products') || '[]');
            const lowStockProducts = products.filter(p => p.stock <= 5);
            const outOfStockProducts = products.filter(p => p.stock === 0);
            
            const container = document.getElementById('inventoryAlerts');
            
            if (lowStockProducts.length === 0 && outOfStockProducts.length === 0) {
                container.innerHTML = `
                    <div class="alert-item success">
                        <i class="fas fa-check-circle"></i>
                        <div>
                            <div class="alert-title">Todo en orden</div>
                            <div class="alert-desc">No hay productos con stock cr칤tico</div>
                        </div>
                    </div>
                `;
            } else {
                let alertsHTML = '';
                
                if (outOfStockProducts.length > 0) {
                    alertsHTML += `
                        <div class="alert-item critical">
                            <i class="fas fa-times-circle"></i>
                            <div>
                                <div class="alert-title">Sin Stock</div>
                                <div class="alert-desc">${outOfStockProducts.length} productos agotados</div>
                            </div>
                        </div>
                    `;
                }
                
                if (lowStockProducts.length > 0) {
                    alertsHTML += `
                        <div class="alert-item warning">
                            <i class="fas fa-exclamation-triangle"></i>
                            <div>
                                <div class="alert-title">Stock Bajo</div>
                                <div class="alert-desc">${lowStockProducts.length} productos necesitan reposici칩n</div>
                            </div>
                        </div>
                    `;
                }
                
                container.innerHTML = alertsHTML;
            }
        }

        // Cargar an치lisis de clientes
        function loadCustomerAnalysis() {
            const clients = JSON.parse(localStorage.getItem('aristore_clients') || '[]');
            
            const newCustomers = clients.filter(client => {
                const addedDate = new Date(client.dateAdded);
                const cutoffDate = new Date();
                cutoffDate.setDate(cutoffDate.getDate() - currentPeriod);
                return addedDate >= cutoffDate;
            }).length;
            
            const vipCustomers = clients.filter(client => client.status === 'vip').length;
            const returningRate = clients.length > 0 ? Math.round((clients.filter(c => c.totalPurchases > 1).length / clients.length) * 100) : 0;
            
            document.getElementById('newCustomers').textContent = newCustomers;
            document.getElementById('vipCustomers').textContent = vipCustomers;
            document.getElementById('returningCustomers').textContent = returningRate + '%';
        }

        // Cargar rendimiento de proveedores
        function loadSupplierPerformance() {
            const suppliers = JSON.parse(localStorage.getItem('aristore_suppliers') || '[]');
            const topSuppliers = suppliers
                .sort((a, b) => b.totalSpent - a.totalSpent)
                .slice(0, 5);
            
            const container = document.getElementById('supplierPerformance');
            container.innerHTML = topSuppliers.map(supplier => `
                <div class="supplier-performance-item">
                    <div class="supplier-name">${supplier.name}</div>
                    <div class="supplier-stats">
                        <div class="supplier-stat">
                            <span class="stat-label">Pedidos:</span>
                            <span class="stat-value">${supplier.totalOrders}</span>
                        </div>
                        <div class="supplier-stat">
                            <span class="stat-label">Total:</span>
                            <span class="stat-value">$${supplier.totalSpent.toLocaleString('es-ES')}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Funciones de exportaci칩n
        function exportChart(chartId) {
            const canvas = document.getElementById(chartId);
            const link = document.createElement('a');
            link.download = `${chartId}_${new Date().toISOString().split('T')[0]}.png`;
            link.href = canvas.toDataURL();
            link.click();
            showAlert('Gr치fico exportado correctamente', 'success');
        }

        function exportTopProducts() {
            const sales = JSON.parse(localStorage.getItem('aristore_sales') || '[]');
            const productSales = {};
            
            sales.forEach(sale => {
                sale.items.forEach(item => {
                    if (productSales[item.name]) {
                        productSales[item.name].quantity += item.quantity;
                        productSales[item.name].revenue += item.price * item.quantity;
                    } else {
                        productSales[item.name] = {
                            quantity: item.quantity,
                            revenue: item.price * item.quantity
                        };
                    }
                });
            });
            
            const topProducts = Object.entries(productSales)
                .sort((a, b) => b[1].quantity - a[1].quantity)
                .slice(0, 10);
            
            const csvData = topProducts.map((product, index) => ({
                'Posici칩n': index + 1,
                'Producto': product[0],
                'Cantidad Vendida': product[1].quantity,
                'Ingresos': product[1].revenue.toFixed(2)
            }));
            
            const ws = XLSX.utils.json_to_sheet(csvData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Top Productos');
            XLSX.writeFile(wb, `Top_Productos_${new Date().toISOString().split('T')[0]}.xlsx`);
            
            showAlert('Reporte de productos exportado', 'success');
        }

        function exportCustomerAnalysis() {
            const clients = JSON.parse(localStorage.getItem('aristore_clients') || '[]');
            
            const analysisData = clients.map(client => ({
                'Nombre': client.name,
                'Email': client.email,
                'Estado': client.status,
                'Total Compras': client.totalPurchases,
                'Total Gastado': client.totalSpent,
                'Fecha Registro': client.dateAdded,
                '칔ltima Compra': client.lastPurchase || 'Nunca'
            }));
            
            const ws = XLSX.utils.json_to_sheet(analysisData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'An치lisis Clientes');
            XLSX.writeFile(wb, `Analisis_Clientes_${new Date().toISOString().split('T')[0]}.xlsx`);
            
            showAlert('An치lisis de clientes exportado', 'success');
        }

        function exportSupplierAnalysis() {
            const suppliers = JSON.parse(localStorage.getItem('aristore_suppliers') || '[]');
            
            const analysisData = suppliers.map(supplier => ({
                'Empresa': supplier.name,
                'Contacto': supplier.contact,
                'Email': supplier.email,
                'Categor칤a': supplier.category,
                'Estado': supplier.status,
                'Total Pedidos': supplier.totalOrders,
                'Total Gastado': supplier.totalSpent,
                '칔ltimo Pedido': supplier.lastOrder || 'Nunca'
            }));
            
            const ws = XLSX.utils.json_to_sheet(analysisData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'An치lisis Proveedores');
            XLSX.writeFile(wb, `Analisis_Proveedores_${new Date().toISOString().split('T')[0]}.xlsx`);
            
            showAlert('An치lisis de proveedores exportado', 'success');
        }

        function exportAllReports() {
            showAlert('Generando reporte completo...', 'info');
            
            setTimeout(() => {
                // Crear un reporte completo en PDF
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // T칤tulo del reporte
                doc.setFontSize(20);
                doc.text('AriStore - Reporte Completo de An치lisis', 20, 20);
                
                doc.setFontSize(12);
                doc.text(`Per칤odo: 칔ltimos ${currentPeriod} d칤as`, 20, 30);
                doc.text(`Fecha de generaci칩n: ${new Date().toLocaleDateString('es-ES')}`, 20, 40);
                
                // M칠tricas principales
                doc.setFontSize(16);
                doc.text('M칠tricas Principales', 20, 60);
                
                doc.setFontSize(12);
                doc.text(`Ingresos Totales: ${document.getElementById('totalRevenue').textContent}`, 20, 75);
                doc.text(`Ganancia Neta: ${document.getElementById('totalProfit').textContent}`, 20, 85);
                doc.text(`Ventas Realizadas: ${document.getElementById('totalSales').textContent}`, 20, 95);
                doc.text(`Ticket Promedio: ${document.getElementById('avgTicket').textContent}`, 20, 105);
                
                // Guardar
                doc.save(`AriStore_Reporte_Completo_${new Date().toISOString().split('T')[0]}.pdf`);
                
                showAlert('Reporte completo exportado correctamente', 'success');
            }, 1500);
        }

        // Reportes r치pidos
        function generateDailyReport() {
            window.open('', 'ReporteDiario').document.write(`
                <html>
                <head><title>Reporte Diario - AriStore</title></head>
                <body style="font-family: Arial; margin: 20px;">
                    <h1>游늵 Reporte Diario - ${new Date().toLocaleDateString('es-ES')}</h1>
                    <h2>Resumen del D칤a</h2>
                    <p>Este es un reporte diario de ejemplo. En una implementaci칩n completa incluir칤a datos detallados del d칤a actual.</p>
                    <button onclick="window.print()" style="padding: 10px 20px; background: #4ecdc4; color: white; border: none; border-radius: 5px;">Imprimir</button>
                </body>
                </html>
            `);
        }

        function generateWeeklyReport() {
            showAlert('Reporte semanal generado', 'success');
        }

        function generateMonthlyReport() {
            showAlert('Reporte mensual generado', 'success');
        }

        function generateInventoryReport() {
            showAlert('Reporte de inventario generado', 'success');
        }

        function generateSalesReport() {
            showAlert('An치lisis de ventas generado', 'success');
        }

        function generateCustomerReport() {
            showAlert('Reporte de clientes generado', 'success');
        }

        function generateSupplierReport() {
            showAlert('An치lisis de proveedores generado', 'success');
        }

        function generateProfitReport() {
            showAlert('An치lisis de rentabilidad generado', 'success');
        }

        // Actualizar reportes
        function refreshReports() {
            showAlert('Actualizando datos...', 'info');
            setTimeout(() => {
                updateMetrics();
                updateCharts();
                loadTopProducts();
                loadInventoryAlerts();
                loadCustomerAnalysis();
                loadSupplierPerformance();
                showAlert('Datos actualizados correctamente', 'success');
            }, 1000);
        }

        // Mostrar alertas
        function showAlert(message, type = 'info') {
            const alert = document.createElement('div');
            alert.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 16px 24px;
                background: rgba(28, 28, 38, 0.95);
                border: 1px solid rgba(255, 255, 255, 0.1);
                border-radius: 12px;
                color: #ffffff;
                z-index: 1001;
                backdrop-filter: blur(20px);
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
                transform: translateX(100%);
                transition: transform 0.3s ease;
            `;
            
            const colors = {
                success: '#4ecdc4',
                error: '#ff6b6b',
                info: '#667eea',
                warning: '#f9ca24'
            };
            alert.style.borderLeftColor = colors[type];
            alert.style.borderLeftWidth = '4px';
            
            alert.textContent = message;
            document.body.appendChild(alert);
            
            setTimeout(() => {
                alert.style.transform = 'translateX(0)';
            }, 100);
            
            setTimeout(() => {
                alert.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    document.body.removeChild(alert);
                }, 300);
            }, 3000);
        }
    </script>

    <!-- Estilos espec칤ficos para reportes -->
    <style>
        .period-selector {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 24px;
            backdrop-filter: blur(20px);
        }

        .period-title {
            color: #ffffff;
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .period-buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .period-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .period-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        .period-btn.active {
            background: linear-gradient(135deg, #4ecdc4, #44bd87);
            color: #fff;
            border-color: #4ecdc4;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .metric-card {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 24px;
            backdrop-filter: blur(20px);
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .metric-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .metric-card.revenue .metric-icon {
            background: linear-gradient(135deg, #4ecdc4, #44bd87);
        }

        .metric-card.profit .metric-icon {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        .metric-card.sales .metric-icon {
            background: linear-gradient(135deg, #f9ca24, #f0932b);
        }

        .metric-card.average .metric-icon {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
        }

        .metric-content {
            flex: 1;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 4px;
        }

        .metric-label {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            margin-bottom: 8px;
        }

        .metric-change {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .metric-change.positive {
            color: #4ecdc4;
        }

        .metric-change.negative {
            color: #ff6b6b;
        }

        .reports-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 24px;
            margin-bottom: 32px;
        }

        .report-card {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 24px;
            backdrop-filter: blur(20px);
            margin-bottom: 24px;
        }

        .report-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .report-title {
            color: #ffffff;
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .export-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 8px 12px;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .export-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
        }

        .chart-container {
            height: 300px;
            position: relative;
        }

        .top-products-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .top-product-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .top-product-item:last-child {
            border-bottom: none;
        }

        .product-rank {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #4ecdc4, #44bd87);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .product-info {
            flex: 1;
        }

        .product-name {
            color: #ffffff;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .product-sales {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.85rem;
        }

        .product-revenue {
            color: #4ecdc4;
            font-weight: 600;
        }

        .alert-card {
            background: rgba(255, 255, 255, 0.02);
        }

        .alert-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .alert-item.success {
            background: rgba(78, 205, 196, 0.1);
            border: 1px solid rgba(78, 205, 196, 0.3);
        }

        .alert-item.warning {
            background: rgba(249, 202, 36, 0.1);
            border: 1px solid rgba(249, 202, 36, 0.3);
        }

        .alert-item.critical {
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid rgba(255, 107, 107, 0.3);
        }

        .alert-title {
            color: #ffffff;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .alert-desc {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.8rem;
        }

        .customer-stats {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .customer-stat {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
        }

        .customer-stat .stat-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .customer-stat .stat-number {
            color: #4ecdc4;
            font-weight: 600;
            font-size: 1.2rem;
        }

        .customer-stat .stat-label {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.85rem;
        }

        .supplier-performance-item {
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .supplier-performance-item:last-child {
            border-bottom: none;
        }

        .supplier-name {
            color: #ffffff;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .supplier-stats {
            display: flex;
            gap: 16px;
        }

        .supplier-stat {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .supplier-stat .stat-label {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.8rem;
        }

        .supplier-stat .stat-value {
            color: #4ecdc4;
            font-weight: 600;
            font-size: 0.85rem;
        }

        .quick-reports {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 24px;
            backdrop-filter: blur(20px);
        }

        .quick-reports-title {
            color: #ffffff;
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .quick-reports-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .quick-report-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: rgba(255, 255, 255, 0.8);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .quick-report-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            transform: translateY(-2px);
        }

        .quick-report-btn i {
            font-size: 2rem;
            color: #4ecdc4;
        }

        .quick-report-btn span {
            font-weight: 500;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .reports-content {
                grid-template-columns: 1fr;
            }
            
            .metrics-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
            
            .quick-reports-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
        }
    </style>

    <!-- Firebase Configuration -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-analytics.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyCzsn9shEOuhQ1ez2_xzRsHHUPXUZeCyyo",
            authDomain: "arisoft-49e7c.firebaseapp.com",
            projectId: "arisoft-49e7c",
            storageBucket: "arisoft-49e7c.firebasestorage.app",
            messagingSenderId: "128011827798",
            appId: "1:128011827798:web:49da366cc846a6e40959f7",
            measurementId: "G-MQ58NER7Q6"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        
        console.log('Firebase Analytics inicializado en m칩dulo Reportes');
    </script>
</body>
</html>
