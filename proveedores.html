<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AriStore - Gestión de Proveedores</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="styles.css" rel="stylesheet">
    <!-- jsPDF y xlsx para exportación -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <a href="index.html" class="back-btn">
                    <i class="fas fa-arrow-left"></i>
                    Volver al Dashboard
                </a>
                <div class="page-title">
                    <div class="page-icon">
                        <i class="fas fa-truck"></i>
                    </div>
                    <div>
                        <h1>Gestión de Proveedores</h1>
                        <p>Administra tu red de proveedores y suministros</p>
                    </div>
                </div>
            </div>
            <div class="header-actions">
                <button class="btn btn-secondary" onclick="showExportMenu()">
                    <i class="fas fa-download"></i>
                    Exportar
                </button>
                <button class="btn" onclick="openAddSupplierModal()">
                    <i class="fas fa-plus"></i>
                    Agregar Proveedor
                </button>
            </div>
        </div>

        <!-- Estadísticas -->
        <div class="stats-grid">
            <div class="stat-card total-suppliers">
                <div class="stat-header">
                    <div>
                        <div class="stat-number" id="totalSuppliers">12</div>
                        <div class="stat-label">Total de Proveedores</div>
                    </div>
                    <div class="stat-icon" style="background: linear-gradient(135deg, #667eea, #764ba2);">
                        <i class="fas fa-truck"></i>
                    </div>
                </div>
            </div>
            <div class="stat-card active-suppliers">
                <div class="stat-header">
                    <div>
                        <div class="stat-number" id="activeSuppliers">8</div>
                        <div class="stat-label">Proveedores Activos</div>
                    </div>
                    <div class="stat-icon" style="background: linear-gradient(135deg, #4ecdc4, #44bd87);">
                        <i class="fas fa-handshake"></i>
                    </div>
                </div>
            </div>
            <div class="stat-card pending-orders">
                <div class="stat-header">
                    <div>
                        <div class="stat-number" id="pendingOrders">5</div>
                        <div class="stat-label">Pedidos Pendientes</div>
                    </div>
                    <div class="stat-icon" style="background: linear-gradient(135deg, #f9ca24, #f0932b);">
                        <i class="fas fa-clock"></i>
                    </div>
                </div>
            </div>
            <div class="stat-card total-spent">
                <div class="stat-header">
                    <div>
                        <div class="stat-number" id="totalSpent">$15,420</div>
                        <div class="stat-label">Total Gastado Este Mes</div>
                    </div>
                    <div class="stat-icon" style="background: linear-gradient(135deg, #ff6b6b, #ee5a24);">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contenido Principal -->
        <div class="main-content">
            <div class="suppliers-section">
                <div class="section-header">
                    <div class="section-title">
                        <i class="fas fa-list"></i>
                        Lista de Proveedores
                    </div>
                    <div style="display: flex; align-items: center; gap: 12px; color: rgba(255, 255, 255, 0.6); font-size: 0.9rem;">
                        <span id="supplierCount">12 proveedores</span>
                    </div>
                </div>

                <div class="search-filter">
                    <div class="search-box">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" class="search-input" placeholder="Buscar por nombre, email o teléfono..." id="searchInput">
                    </div>
                    <select class="filter-select" id="statusFilter">
                        <option value="">Todos los estados</option>
                        <option value="activo">Activos</option>
                        <option value="inactivo">Inactivos</option>
                        <option value="pendiente">Pendientes</option>
                        <option value="preferido">Preferidos</option>
                    </select>
                    <select class="filter-select" id="categoryFilter">
                        <option value="">Todas las categorías</option>
                        <option value="electronica">Electrónica</option>
                        <option value="accesorios">Accesorios</option>
                        <option value="cables">Cables</option>
                        <option value="audio">Audio</option>
                        <option value="cargadores">Cargadores</option>
                    </select>
                </div>

                <table class="inventory-table">
                    <thead>
                        <tr>
                            <th>Proveedor</th>
                            <th>Código</th>
                            <th>Contacto</th>
                            <th>Categoría</th>
                            <th>Pedidos</th>
                            <th>Total Comprado</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="suppliersTableBody">
                        <!-- Los proveedores se cargarán dinámicamente -->
                    </tbody>
                </table>
            </div>

            <div class="sidebar">
                <div class="quick-actions">
                    <h3>
                        <i class="fas fa-bolt"></i>
                        Acciones Rápidas
                    </h3>
                    <a href="#" class="quick-action-btn" onclick="openAddSupplierModal()">
                        <i class="fas fa-plus"></i>
                        Agregar Proveedor
                    </a>
                    <a href="#" class="quick-action-btn" onclick="newPurchaseOrder()">
                        <i class="fas fa-shopping-cart"></i>
                        Nueva Orden
                    </a>
                    <a href="#" class="quick-action-btn" onclick="checkPendingOrders()">
                        <i class="fas fa-clock"></i>
                        Pedidos Pendientes
                    </a>
                    <a href="#" class="quick-action-btn" onclick="suppliersReport()">
                        <i class="fas fa-chart-pie"></i>
                        Reporte Proveedores
                    </a>
                </div>

                <div class="recent-activity">
                    <h3 style="color: #ffffff; font-size: 1.1rem; font-weight: 600; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-clock"></i>
                        Actividad Reciente
                    </h3>
                    <div class="activity-item">
                        <div class="activity-icon" style="background: linear-gradient(135deg, #4ecdc4, #44bd87);">
                            <i class="fas fa-truck"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">Pedido entregado</div>
                            <div class="activity-time">Hace 1 hora</div>
                        </div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon" style="background: linear-gradient(135deg, #f9ca24, #f0932b);">
                            <i class="fas fa-plus"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">Proveedor agregado</div>
                            <div class="activity-time">Hace 3 horas</div>
                        </div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon" style="background: linear-gradient(135deg, #667eea, #764ba2);">
                            <i class="fas fa-edit"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">Información actualizada</div>
                            <div class="activity-time">Hace 5 horas</div>
                        </div>
                    </div>
                </div>

                <!-- Top Proveedores -->
                <div class="recent-activity">
                    <h3 style="color: #ffffff; font-size: 1.1rem; font-weight: 600; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-trophy"></i>
                        Top Proveedores
                    </h3>
                    <div id="topSuppliers">
                        <!-- Se cargará dinámicamente -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Agregar/Editar Proveedor -->
    <div class="modal" id="supplierModal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-truck"></i>
                    <span id="modalTitle">Agregar Proveedor</span>
                </div>
                <button class="close-btn" onclick="closeSupplierModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="supplierForm">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Nombre de la Empresa</label>
                        <input type="text" class="form-input" id="supplierName" placeholder="Ej: TechSupply S.A." required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Código Proveedor</label>
                        <input type="text" class="form-input" id="supplierCode" placeholder="Se genera automáticamente" readonly style="background: rgba(255,255,255,0.05);">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" id="supplierEmail" placeholder="contacto@proveedor.com" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Teléfono</label>
                        <input type="tel" class="form-input" id="supplierPhone" placeholder="+34 900 123 456" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Contacto Principal</label>
                        <input type="text" class="form-input" id="supplierContact" placeholder="Nombre del representante">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Categoría Principal</label>
                        <select class="form-select" id="supplierCategory" required>
                            <option value="">Seleccionar categoría</option>
                            <option value="electronica">Electrónica</option>
                            <option value="accesorios">Accesorios</option>
                            <option value="cables">Cables y Conectores</option>
                            <option value="audio">Audio y Sonido</option>
                            <option value="cargadores">Cargadores</option>
                            <option value="otros">Otros</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Dirección</label>
                        <input type="text" class="form-input" id="supplierAddress" placeholder="Dirección completa">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ciudad</label>
                        <input type="text" class="form-input" id="supplierCity" placeholder="Ej: Madrid, Barcelona...">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Términos de Pago (días)</label>
                        <input type="number" class="form-input" id="supplierPaymentTerms" placeholder="30" min="1" max="365">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Estado</label>
                        <select class="form-select" id="supplierStatus" required>
                            <option value="activo">Activo</option>
                            <option value="inactivo">Inactivo</option>
                            <option value="pendiente">Pendiente</option>
                            <option value="preferido">Preferido</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Notas</label>
                    <textarea class="form-textarea" id="supplierNotes" placeholder="Información adicional sobre el proveedor (opcional)"></textarea>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeSupplierModal()">
                        Cancelar
                    </button>
                    <button type="submit" class="btn">
                        <i class="fas fa-save"></i>
                        Guardar Proveedor
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Detalles del Proveedor -->
    <div class="modal" id="supplierDetailsModal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-building"></i>
                    <span>Detalles del Proveedor</span>
                </div>
                <button class="close-btn" onclick="closeSupplierDetailsModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div id="supplierDetailsContent">
                <!-- El contenido se cargará dinámicamente -->
            </div>
        </div>
    </div>

    <!-- Modal de Exportación -->
    <div class="modal" id="exportModal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-download"></i>
                    <span>Exportar Proveedores</span>
                </div>
                <button class="close-btn" onclick="closeExportModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div style="padding: 8px 0;">
                <button class="btn" style="width: 100%; margin-bottom: 12px;" onclick="exportToPDF()">
                    <i class="fas fa-file-pdf"></i>
                    Exportar a PDF
                </button>
                <button class="btn btn-secondary" style="width: 100%; margin-bottom: 12px;" onclick="exportToExcel()">
                    <i class="fas fa-file-excel"></i>
                    Exportar a Excel
                </button>
                <button class="btn btn-secondary" style="width: 100%;" onclick="exportToCSV()">
                    <i class="fas fa-file-csv"></i>
                    Exportar a CSV
                </button>
            </div>
        </div>
    </div>

    <script>
        // Datos de proveedores
        let suppliersData = [];
        let currentEditingId = null;

        // Cargar datos desde localStorage o usar datos por defecto
        function loadSuppliersData() {
            const savedData = localStorage.getItem('aristore_suppliers');
            if (savedData) {
                suppliersData = JSON.parse(savedData);
            } else {
                // Datos por defecto si no hay datos guardados
                suppliersData = [
                    {
                        id: 1,
                        code: "PROV-001",
                        name: "TechSupply Barcelona",
                        email: "ventas@techsupply.es",
                        phone: "+34 93 123 4567",
                        contact: "Carlos Martínez",
                        category: "electronica",
                        address: "Carrer de Balmes, 200, Barcelona",
                        city: "Barcelona",
                        paymentTerms: 30,
                        status: "preferido",
                        notes: "Proveedor principal de productos electrónicos. Excelente calidad y precios competitivos.",
                        totalOrders: 45,
                        totalSpent: 28500.75,
                        lastOrder: "2024-07-28",
                        dateAdded: "2020-03-15"
                    },
                    {
                        id: 2,
                        code: "PROV-002",
                        name: "AccesoriosPro Madrid",
                        email: "info@accesorios-pro.com",
                        phone: "+34 91 456 7890",
                        contact: "Ana López",
                        category: "accesorios",
                        address: "Calle de Alcalá, 150, Madrid",
                        city: "Madrid",
                        paymentTerms: 45,
                        status: "activo",
                        notes: "Especialistas en fundas y protectores. Buen servicio al cliente.",
                        totalOrders: 32,
                        totalSpent: 15240.30,
                        lastOrder: "2024-07-25",
                        dateAdded: "2021-01-20"
                    },
                    {
                        id: 3,
                        code: "PROV-003",
                        name: "AudioTech Solutions",
                        email: "pedidos@audiotech.es",
                        phone: "+34 96 789 0123",
                        contact: "Miguel Rodríguez",
                        category: "audio",
                        address: "Avenida del Puerto, 85, Valencia",
                        city: "Valencia",
                        paymentTerms: 30,
                        status: "activo",
                        notes: "Proveedor especializado en auriculares y dispositivos de audio.",
                        totalOrders: 28,
                        totalSpent: 19850.60,
                        lastOrder: "2024-07-22",
                        dateAdded: "2021-06-10"
                    },
                    {
                        id: 4,
                        code: "PROV-004",
                        name: "CableMax Distribución",
                        email: "comercial@cablemax.com",
                        phone: "+34 95 234 5678",
                        contact: "Laura Fernández",
                        category: "cables",
                        address: "Polígono Industrial, Calle 12, Sevilla",
                        city: "Sevilla",
                        paymentTerms: 60,
                        status: "activo",
                        notes: "Gran variedad de cables y conectores. Precios mayoristas excelentes.",
                        totalOrders: 38,
                        totalSpent: 12680.45,
                        lastOrder: "2024-07-20",
                        dateAdded: "2020-09-05"
                    },
                    {
                        id: 5,
                        code: "PROV-005",
                        name: "PowerCharge España",
                        email: "ventas@powercharge.es",
                        phone: "+34 94 567 8901",
                        contact: "David García",
                        category: "cargadores",
                        address: "Gran Vía, 45, Bilbao",
                        city: "Bilbao",
                        paymentTerms: 30,
                        status: "preferido",
                        notes: "Especialistas en cargadores inalámbricos y rápidos. Muy confiables.",
                        totalOrders: 41,
                        totalSpent: 22340.80,
                        lastOrder: "2024-07-26",
                        dateAdded: "2021-03-08"
                    },
                    {
                        id: 6,
                        code: "PROV-006",
                        name: "GlobalTech Import",
                        email: "import@globaltech.com",
                        phone: "+34 92 345 6789",
                        contact: "Patricia Sánchez",
                        category: "electronica",
                        address: "Puerto Comercial, Málaga",
                        city: "Málaga",
                        paymentTerms: 90,
                        status: "inactivo",
                        notes: "Importador directo desde Asia. Últimamente con problemas de calidad.",
                        totalOrders: 15,
                        totalSpent: 8950.20,
                        lastOrder: "2024-05-10",
                        dateAdded: "2022-11-12"
                    }
                ];
                saveSuppliersData();
            }
        }

        // Guardar datos en localStorage
        function saveSuppliersData() {
            localStorage.setItem('aristore_suppliers', JSON.stringify(suppliersData));
        }

        // Generar código automático para proveedor
        function generateSupplierCode() {
            const maxId = Math.max(0, ...suppliersData.map(s => s.id));
            const nextId = maxId + 1;
            return `PROV-${nextId.toString().padStart(3, '0')}`;
        }

        // Inicializar la página
        document.addEventListener('DOMContentLoaded', function() {
            loadSuppliersData();
            updateStats();
            renderSuppliersTable();
            renderTopSuppliers();
            setupEventListeners();
        });

        // Configurar event listeners
        function setupEventListeners() {
            document.getElementById('searchInput').addEventListener('input', filterSuppliers);
            document.getElementById('statusFilter').addEventListener('change', filterSuppliers);
            document.getElementById('categoryFilter').addEventListener('change', filterSuppliers);
            document.getElementById('supplierForm').addEventListener('submit', handleSupplierSubmit);
        }

        // Actualizar estadísticas
        function updateStats() {
            const totalSuppliers = suppliersData.length;
            const activeSuppliers = suppliersData.filter(supplier => 
                supplier.status === 'activo' || supplier.status === 'preferido'
            ).length;
            
            // Calcular pedidos pendientes (simulado)
            const pendingOrders = Math.floor(totalSuppliers * 0.4);
            
            // Calcular total gastado este mes
            const thisMonth = new Date().getMonth();
            const thisYear = new Date().getFullYear();
            const monthlySpent = suppliersData.reduce((sum, supplier) => {
                const lastOrderDate = new Date(supplier.lastOrder);
                if (lastOrderDate.getMonth() === thisMonth && lastOrderDate.getFullYear() === thisYear) {
                    return sum + (supplier.totalSpent * 0.1); // Aproximación del gasto mensual
                }
                return sum;
            }, 0);

            document.getElementById('totalSuppliers').textContent = totalSuppliers;
            document.getElementById('activeSuppliers').textContent = activeSuppliers;
            document.getElementById('pendingOrders').textContent = pendingOrders;
            document.getElementById('totalSpent').textContent = `$${monthlySpent.toLocaleString('es-ES', {minimumFractionDigits: 2})}`;
            document.getElementById('supplierCount').textContent = `${totalSuppliers} proveedores`;
        }

        // Renderizar tabla de proveedores
        function renderSuppliersTable(data = suppliersData) {
            const tbody = document.getElementById('suppliersTableBody');
            tbody.innerHTML = '';

            data.forEach(supplier => {
                const row = document.createElement('tr');
                
                const statusInfo = getStatusInfo(supplier.status);
                const categoryName = getCategoryName(supplier.category);

                row.innerHTML = `
                    <td>
                        <div class="product-info">
                            <div class="product-image">
                                <i class="fas fa-building" style="font-size: 2rem; color: #667eea;"></i>
                            </div>
                            <div class="product-details">
                                <h4>${supplier.name}</h4>
                                <p>Proveedor desde: ${new Date(supplier.dateAdded).toLocaleDateString('es-ES')}</p>
                            </div>
                        </div>
                    </td>
                    <td style="color: #4ecdc4; font-weight: 600;">${supplier.code}</td>
                    <td>
                        <div style="color: rgba(255,255,255,0.8);">
                            <div>${supplier.contact}</div>
                            <div style="font-size: 0.85rem; color: rgba(255,255,255,0.6);">${supplier.email}</div>
                            <div style="font-size: 0.85rem; color: rgba(255,255,255,0.6);">${supplier.phone}</div>
                        </div>
                    </td>
                    <td style="color: rgba(255,255,255,0.8);">${categoryName}</td>
                    <td style="color: #4ecdc4; font-weight: 600;">${supplier.totalOrders}</td>
                    <td style="color: #4ecdc4; font-weight: 600;">$${supplier.totalSpent.toLocaleString('es-ES', {minimumFractionDigits: 2})}</td>
                    <td>
                        <span class="stock-badge ${statusInfo.class}">${statusInfo.label}</span>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn edit" onclick="viewSupplierDetails(${supplier.id})" title="Ver detalles">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="action-btn edit" onclick="editSupplier(${supplier.id})" title="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete" onclick="deleteSupplier(${supplier.id})" title="Eliminar">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // Renderizar top proveedores
        function renderTopSuppliers() {
            const topSuppliers = [...suppliersData]
                .sort((a, b) => b.totalSpent - a.totalSpent)
                .slice(0, 5);

            const container = document.getElementById('topSuppliers');
            container.innerHTML = topSuppliers.map((supplier, index) => `
                <div class="activity-item">
                    <div class="activity-icon" style="background: linear-gradient(135deg, #667eea, #764ba2); font-size: 0.8rem; font-weight: bold;">
                        ${index + 1}
                    </div>
                    <div class="activity-content">
                        <div class="activity-title">${supplier.name}</div>
                        <div class="activity-time">$${supplier.totalSpent.toLocaleString('es-ES', {minimumFractionDigits: 2})}</div>
                    </div>
                </div>
            `).join('');
        }

        // Obtener información del estado
        function getStatusInfo(status) {
            const statusMap = {
                'activo': { class: 'high', label: 'Activo' },
                'inactivo': { class: 'out', label: 'Inactivo' },
                'preferido': { class: 'vip', label: 'Preferido' },
                'pendiente': { class: 'medium', label: 'Pendiente' }
            };
            return statusMap[status] || { class: 'medium', label: status };
        }

        // Obtener nombre de categoría
        function getCategoryName(category) {
            const categories = {
                'electronica': 'Electrónica',
                'accesorios': 'Accesorios',
                'cables': 'Cables',
                'audio': 'Audio',
                'cargadores': 'Cargadores',
                'otros': 'Otros'
            };
            return categories[category] || category;
        }

        // Filtrar proveedores
        function filterSuppliers() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;
            const categoryFilter = document.getElementById('categoryFilter').value;

            let filteredData = suppliersData.filter(supplier => {
                const matchesSearch = supplier.name.toLowerCase().includes(searchTerm) || 
                                    supplier.email.toLowerCase().includes(searchTerm) ||
                                    supplier.phone.includes(searchTerm) ||
                                    supplier.contact.toLowerCase().includes(searchTerm);
                
                const matchesStatus = !statusFilter || supplier.status === statusFilter;
                const matchesCategory = !categoryFilter || supplier.category === categoryFilter;

                return matchesSearch && matchesStatus && matchesCategory;
            });

            renderSuppliersTable(filteredData);
            document.getElementById('supplierCount').textContent = `${filteredData.length} proveedores`;
        }

        // Abrir modal para agregar proveedor
        function openAddSupplierModal() {
            currentEditingId = null;
            document.getElementById('modalTitle').textContent = 'Agregar Proveedor';
            document.getElementById('supplierForm').reset();
            document.getElementById('supplierStatus').value = 'activo';
            document.getElementById('supplierCode').value = generateSupplierCode();
            document.getElementById('supplierModal').classList.add('show');
        }

        // Cerrar modal
        function closeSupplierModal() {
            document.getElementById('supplierModal').classList.remove('show');
            currentEditingId = null;
        }

        // Editar proveedor
        function editSupplier(id) {
            const supplier = suppliersData.find(s => s.id === id);
            if (!supplier) {
                showAlert('Proveedor no encontrado', 'error');
                return;
            }

            currentEditingId = id;
            document.getElementById('modalTitle').textContent = 'Editar Proveedor';
            
            // Llenar campos del formulario
            document.getElementById('supplierName').value = supplier.name || '';
            document.getElementById('supplierCode').value = supplier.code || '';
            document.getElementById('supplierEmail').value = supplier.email || '';
            document.getElementById('supplierPhone').value = supplier.phone || '';
            document.getElementById('supplierContact').value = supplier.contact || '';
            document.getElementById('supplierCategory').value = supplier.category || '';
            document.getElementById('supplierAddress').value = supplier.address || '';
            document.getElementById('supplierCity').value = supplier.city || '';
            document.getElementById('supplierPaymentTerms').value = supplier.paymentTerms || '';
            document.getElementById('supplierStatus').value = supplier.status || 'activo';
            document.getElementById('supplierNotes').value = supplier.notes || '';

            document.getElementById('supplierModal').classList.add('show');
        }

        // Ver detalles del proveedor
        function viewSupplierDetails(id) {
            const supplier = suppliersData.find(s => s.id === id);
            if (!supplier) {
                showAlert('Proveedor no encontrado', 'error');
                return;
            }

            const statusInfo = getStatusInfo(supplier.status);
            const categoryName = getCategoryName(supplier.category);
            const lastOrderDate = supplier.lastOrder ? new Date(supplier.lastOrder).toLocaleDateString('es-ES') : 'Nunca';
            const averageOrderValue = supplier.totalOrders > 0 ? supplier.totalSpent / supplier.totalOrders : 0;

            const content = document.getElementById('supplierDetailsContent');
            content.innerHTML = `
                <div style="padding: 24px;">
                    <!-- Header del proveedor -->
                    <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                        <div style="font-size: 4rem; color: #667eea;">
                            <i class="fas fa-building"></i>
                        </div>
                        <div>
                            <h2 style="color: #fff; margin-bottom: 8px;">${supplier.name}</h2>
                            <p style="color: rgba(255,255,255,0.6); margin-bottom: 4px;">${supplier.email}</p>
                            <p style="color: rgba(255,255,255,0.6); margin-bottom: 8px;">Código: ${supplier.code}</p>
                            <span class="stock-badge ${statusInfo.class}">${statusInfo.label}</span>
                        </div>
                    </div>

                    <!-- Información de contacto -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
                        <div>
                            <h3 style="color: #4ecdc4; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                                <i class="fas fa-address-card"></i>
                                Información de Contacto
                            </h3>
                            <div style="background: rgba(255,255,255,0.02); padding: 20px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.05);">
                                <div style="margin-bottom: 12px;">
                                    <strong style="color: rgba(255,255,255,0.8);">Contacto:</strong>
                                    <span style="color: #fff; margin-left: 8px;">${supplier.contact}</span>
                                </div>
                                <div style="margin-bottom: 12px;">
                                    <strong style="color: rgba(255,255,255,0.8);">Teléfono:</strong>
                                    <span style="color: #fff; margin-left: 8px;">${supplier.phone}</span>
                                </div>
                                <div style="margin-bottom: 12px;">
                                    <strong style="color: rgba(255,255,255,0.8);">Categoría:</strong>
                                    <span style="color: #fff; margin-left: 8px;">${categoryName}</span>
                                </div>
                                <div>
                                    <strong style="color: rgba(255,255,255,0.8);">Términos de Pago:</strong>
                                    <span style="color: #fff; margin-left: 8px;">${supplier.paymentTerms} días</span>
                                </div>
                            </div>
                        </div>

                        <div>
                            <h3 style="color: #4ecdc4; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                                <i class="fas fa-chart-line"></i>
                                Estadísticas de Compras
                            </h3>
                            <div style="background: rgba(255,255,255,0.02); padding: 20px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.05);">
                                <div style="margin-bottom: 12px;">
                                    <strong style="color: rgba(255,255,255,0.8);">Total de pedidos:</strong>
                                    <span style="color: #4ecdc4; margin-left: 8px; font-weight: 600;">${supplier.totalOrders}</span>
                                </div>
                                <div style="margin-bottom: 12px;">
                                    <strong style="color: rgba(255,255,255,0.8);">Total gastado:</strong>
                                    <span style="color: #4ecdc4; margin-left: 8px; font-weight: 600;">$${supplier.totalSpent.toLocaleString('es-ES', {minimumFractionDigits: 2})}</span>
                                </div>
                                <div style="margin-bottom: 12px;">
                                    <strong style="color: rgba(255,255,255,0.8);">Promedio por pedido:</strong>
                                    <span style="color: #4ecdc4; margin-left: 8px; font-weight: 600;">$${averageOrderValue.toFixed(2)}</span>
                                </div>
                                <div>
                                    <strong style="color: rgba(255,255,255,0.8);">Último pedido:</strong>
                                    <span style="color: #fff; margin-left: 8px;">${lastOrderDate}</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Dirección -->
                    <div style="margin-bottom: 30px;">
                        <h3 style="color: #4ecdc4; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-map-marker-alt"></i>
                            Dirección
                        </h3>
                        <div style="background: rgba(255,255,255,0.02); padding: 20px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.05);">
                            <p style="color: #fff; margin-bottom: 8px;">${supplier.address || 'No especificada'}</p>
                            <p style="color: rgba(255,255,255,0.8);">${supplier.city || 'Ciudad no especificada'}</p>
                        </div>
                    </div>

                    <!-- Notas -->
                    ${supplier.notes ? `
                        <div>
                            <h3 style="color: #4ecdc4; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                                <i class="fas fa-sticky-note"></i>
                                Notas
                            </h3>
                            <div style="background: rgba(255,255,255,0.02); padding: 20px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.05);">
                                <p style="color: #fff; line-height: 1.6;">${supplier.notes}</p>
                            </div>
                        </div>
                    ` : ''}

                    <!-- Acciones -->
                    <div style="display: flex; gap: 12px; margin-top: 30px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
                        <button onclick="editSupplier(${supplier.id}); closeSupplierDetailsModal();" class="btn" style="flex: 1;">
                            <i class="fas fa-edit"></i>
                            Editar Proveedor
                        </button>
                        <button onclick="sendEmail('${supplier.email}')" class="btn btn-secondary" style="flex: 1;">
                            <i class="fas fa-envelope"></i>
                            Enviar Email
                        </button>
                    </div>
                </div>
            `;

            document.getElementById('supplierDetailsModal').classList.add('show');
        }

        // Cerrar modal de detalles
        function closeSupplierDetailsModal() {
            document.getElementById('supplierDetailsModal').classList.remove('show');
        }

        // Manejar envío del formulario
        function handleSupplierSubmit(e) {
            e.preventDefault();

            const supplierData = {
                name: document.getElementById('supplierName').value,
                code: document.getElementById('supplierCode').value,
                email: document.getElementById('supplierEmail').value,
                phone: document.getElementById('supplierPhone').value,
                contact: document.getElementById('supplierContact').value,
                category: document.getElementById('supplierCategory').value,
                address: document.getElementById('supplierAddress').value,
                city: document.getElementById('supplierCity').value,
                paymentTerms: parseInt(document.getElementById('supplierPaymentTerms').value) || 30,
                status: document.getElementById('supplierStatus').value,
                notes: document.getElementById('supplierNotes').value
            };

            // Validar email único
            const isDuplicateEmail = suppliersData.some(s => 
                s.email === supplierData.email && s.id !== currentEditingId
            );

            if (isDuplicateEmail) {
                showAlert('El email ya está registrado para otro proveedor.', 'error');
                return;
            }

            if (currentEditingId) {
                // Editar proveedor existente
                const index = suppliersData.findIndex(s => s.id === currentEditingId);
                if (index !== -1) {
                    suppliersData[index] = { ...suppliersData[index], ...supplierData };
                    showAlert('Proveedor actualizado correctamente', 'success');
                }
            } else {
                // Agregar nuevo proveedor
                const newId = Math.max(0, ...suppliersData.map(s => s.id)) + 1;
                const newSupplier = {
                    ...supplierData,
                    id: newId,
                    totalOrders: 0,
                    totalSpent: 0,
                    lastOrder: null,
                    dateAdded: new Date().toISOString().split('T')[0]
                };
                suppliersData.push(newSupplier);
                showAlert('Proveedor agregado correctamente', 'success');
            }

            saveSuppliersData();
            updateStats();
            renderSuppliersTable();
            renderTopSuppliers();
            closeSupplierModal();
        }

        // Eliminar proveedor
        function deleteSupplier(id) {
            const supplier = suppliersData.find(s => s.id === id);
            if (!supplier) {
                showAlert('Proveedor no encontrado', 'error');
                return;
            }

            if (confirm(`¿Estás seguro de que deseas eliminar a "${supplier.name}"?\n\nEsta acción no se puede deshacer y se perderá todo el historial de pedidos.`)) {
                suppliersData = suppliersData.filter(s => s.id !== id);
                saveSuppliersData();
                updateStats();
                renderSuppliersTable();
                renderTopSuppliers();
                showAlert('Proveedor eliminado correctamente', 'success');
            }
        }

        // Enviar email
        function sendEmail(email) {
            window.open(`mailto:${email}`, '_blank');
        }

        // Mostrar menú de exportación
        function showExportMenu() {
            document.getElementById('exportModal').classList.add('show');
        }

        // Cerrar modal de exportación
        function closeExportModal() {
            document.getElementById('exportModal').classList.remove('show');
        }

        // Exportar a PDF
        function exportToPDF() {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                doc.setFontSize(20);
                doc.text('AriStore - Reporte de Proveedores', 20, 20);
                
                doc.setFontSize(12);
                doc.text(`Fecha de generación: ${new Date().toLocaleDateString('es-ES')}`, 20, 30);
                doc.text(`Total de proveedores: ${suppliersData.length}`, 20, 40);
                
                const tableData = suppliersData.map(supplier => [
                    supplier.name,
                    supplier.code,
                    supplier.contact,
                    supplier.phone,
                    getCategoryName(supplier.category),
                    supplier.totalOrders.toString(),
                    `$${supplier.totalSpent.toFixed(2)}`,
                    getStatusInfo(supplier.status).label
                ]);
                
                doc.autoTable({
                    head: [['Empresa', 'Código', 'Contacto', 'Teléfono', 'Categoría', 'Pedidos', 'Total Gastado', 'Estado']],
                    body: tableData,
                    startY: 50,
                    styles: { fontSize: 8, cellPadding: 3 },
                    headStyles: { fillColor: [102, 126, 234], textColor: 255 }
                });
                
                doc.save(`AriStore_Proveedores_${new Date().toISOString().split('T')[0]}.pdf`);
                closeExportModal();
                showAlert('Reporte PDF generado correctamente', 'success');
            } catch (error) {
                console.error('Error al generar PDF:', error);
                showAlert('Error al generar el PDF', 'error');
            }
        }

        // Exportar a Excel
        function exportToExcel() {
            try {
                const excelData = suppliersData.map(supplier => ({
                    'Empresa': supplier.name,
                    'Código': supplier.code,
                    'Email': supplier.email,
                    'Teléfono': supplier.phone,
                    'Contacto': supplier.contact,
                    'Categoría': getCategoryName(supplier.category),
                    'Dirección': supplier.address || '',
                    'Ciudad': supplier.city || '',
                    'Términos Pago': supplier.paymentTerms,
                    'Estado': getStatusInfo(supplier.status).label,
                    'Total Pedidos': supplier.totalOrders,
                    'Total Gastado': supplier.totalSpent,
                    'Último Pedido': supplier.lastOrder || '',
                    'Fecha Registro': supplier.dateAdded,
                    'Notas': supplier.notes || ''
                }));
                
                const wb = XLSX.utils.book_new();
                const ws = XLSX.utils.json_to_sheet(excelData);
                XLSX.utils.book_append_sheet(wb, ws, 'Proveedores');
                XLSX.writeFile(wb, `AriStore_Proveedores_${new Date().toISOString().split('T')[0]}.xlsx`);
                
                closeExportModal();
                showAlert('Archivo Excel generado correctamente', 'success');
            } catch (error) {
                console.error('Error al generar Excel:', error);
                showAlert('Error al generar el archivo Excel', 'error');
            }
        }

        // Exportar a CSV
        function exportToCSV() {
            try {
                const csvData = suppliersData.map(supplier => ({
                    'Empresa': supplier.name,
                    'Código': supplier.code,
                    'Email': supplier.email,
                    'Teléfono': supplier.phone,
                    'Contacto': supplier.contact,
                    'Categoría': getCategoryName(supplier.category),
                    'Ciudad': supplier.city || '',
                    'Estado': getStatusInfo(supplier.status).label,
                    'Total Pedidos': supplier.totalOrders,
                    'Total Gastado': supplier.totalSpent,
                    'Fecha Registro': supplier.dateAdded
                }));
                
                const ws = XLSX.utils.json_to_sheet(csvData);
                const csv = XLSX.utils.sheet_to_csv(ws);
                
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', `AriStore_Proveedores_${new Date().toISOString().split('T')[0]}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                closeExportModal();
                showAlert('Archivo CSV generado correctamente', 'success');
            } catch (error) {
                console.error('Error al generar CSV:', error);
                showAlert('Error al generar el archivo CSV', 'error');
            }
        }

        // Funciones de acciones rápidas
        function newPurchaseOrder() {
            showAlert('Función de nueva orden de compra en desarrollo', 'info');
        }

        function checkPendingOrders() {
            const pendingCount = Math.floor(suppliersData.length * 0.4);
            showAlert(`Tienes ${pendingCount} pedidos pendientes de seguimiento`, 'info');
        }

        function suppliersReport() {
            // Generar reporte detallado en nueva ventana
            const reportWindow = window.open('', 'ReporteProveedores', 'width=900,height=700');
            
            const totalSpent = suppliersData.reduce((sum, supplier) => sum + supplier.totalSpent, 0);
            const averageSpent = totalSpent / suppliersData.length;
            const topSupplier = suppliersData.reduce((top, supplier) => 
                supplier.totalSpent > top.totalSpent ? supplier : top, suppliersData[0]);

            const reportHTML = `
                <!DOCTYPE html>
                <html lang="es">
                <head>
                    <meta charset="UTF-8">
                    <title>AriStore - Reporte de Proveedores</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; color: #333; }
                        .header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #667eea; padding-bottom: 20px; }
                        .logo { font-size: 2rem; font-weight: bold; color: #667eea; }
                        .stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
                        .stat-card { background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center; border-left: 4px solid #667eea; }
                        .stat-number { font-size: 1.8rem; font-weight: bold; color: #667eea; }
                        .stat-label { color: #666; font-size: 0.9rem; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
                        th { background-color: #667eea; color: white; }
                        tr:nth-child(even) { background-color: #f2f2f2; }
                        .status-preferido { color: #ff6b6b; font-weight: bold; }
                        .status-activo { color: #4ecdc4; font-weight: bold; }
                        .status-pendiente { color: #f9ca24; font-weight: bold; }
                        .status-inactivo { color: #666; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <div class="logo">🚚 AriStore</div>
                        <h2>Reporte Detallado de Proveedores</h2>
                        <p>Generado el: ${new Date().toLocaleDateString('es-ES', { 
                            year: 'numeric', month: 'long', day: 'numeric',
                            hour: '2-digit', minute: '2-digit'
                        })}</p>
                    </div>
                    
                    <div class="stats">
                        <div class="stat-card">
                            <div class="stat-number">${suppliersData.length}</div>
                            <div class="stat-label">Total Proveedores</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">$${totalSpent.toLocaleString('es-ES', {minimumFractionDigits: 2})}</div>
                            <div class="stat-label">Total Invertido</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">$${averageSpent.toFixed(2)}</div>
                            <div class="stat-label">Promedio por Proveedor</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${suppliersData.filter(s => s.status === 'preferido').length}</div>
                            <div class="stat-label">Proveedores Preferidos</div>
                        </div>
                    </div>

                    <h3>Top Proveedor: ${topSupplier.name} - $${topSupplier.totalSpent.toLocaleString('es-ES', {minimumFractionDigits: 2})}</h3>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>Empresa</th>
                                <th>Contacto</th>
                                <th>Categoría</th>
                                <th>Pedidos</th>
                                <th>Total Gastado</th>
                                <th>Estado</th>
                                <th>Último Pedido</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${suppliersData.map(supplier => `
                                <tr>
                                    <td>${supplier.name}</td>
                                    <td>${supplier.contact}<br><small>${supplier.email}</small></td>
                                    <td>${getCategoryName(supplier.category)}</td>
                                    <td>${supplier.totalOrders}</td>
                                    <td>$${supplier.totalSpent.toLocaleString('es-ES', {minimumFractionDigits: 2})}</td>
                                    <td class="status-${supplier.status}">${getStatusInfo(supplier.status).label}</td>
                                    <td>${supplier.lastOrder ? new Date(supplier.lastOrder).toLocaleDateString('es-ES') : 'Nunca'}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    
                    <div style="text-align: center; margin-top: 30px;">
                        <button onclick="window.print()" style="padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            Imprimir Reporte
                        </button>
                    </div>
                </body>
                </html>
            `;
            
            reportWindow.document.write(reportHTML);
            reportWindow.document.close();
            
            showAlert('Reporte generado en nueva ventana', 'success');
        }

        // Mostrar alertas
        function showAlert(message, type = 'info') {
            const alert = document.createElement('div');
            alert.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 16px 24px;
                background: rgba(28, 28, 38, 0.95);
                border: 1px solid rgba(255, 255, 255, 0.1);
                border-radius: 12px;
                color: #ffffff;
                z-index: 1001;
                backdrop-filter: blur(20px);
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
                transform: translateX(100%);
                transition: transform 0.3s ease;
            `;
            
            const colors = {
                success: '#4ecdc4',
                error: '#ff6b6b',
                info: '#667eea'
            };
            alert.style.borderLeftColor = colors[type];
            alert.style.borderLeftWidth = '4px';
            
            alert.textContent = message;
            document.body.appendChild(alert);
            
            setTimeout(() => {
                alert.style.transform = 'translateX(0)';
            }, 100);
            
            setTimeout(() => {
                alert.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    document.body.removeChild(alert);
                }, 300);
            }, 3000);
        }

        // Cerrar modales al hacer clic fuera
        document.getElementById('supplierModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeSupplierModal();
            }
        });

        document.getElementById('supplierDetailsModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeSupplierDetailsModal();
            }
        });

        document.getElementById('exportModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeExportModal();
            }
        });
    </script>

    <!-- Agregar estilos específicos para el estado Preferido -->
    <style>
        .stock-badge.vip {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            font-weight: 600;
        }
    </style>
</body>
</html>
