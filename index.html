<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AriStore - Sistema de Gestión</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="styles.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo-container">
                <img src="logos/aristore.png" alt="AriStore Logo" class="logo">
                <div>
                    <h1>AriStore</h1>
                    <p>Sistema de Gestión de Accesorios</p>
                </div>
            </div>
            
            <!-- Barra de Navegación -->
            <div class="navbar">
                <a href="#" class="nav-item active" onclick="navigateTo('dashboard')">
                    <i class="nav-icon fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="nav-item" onclick="navigateTo('inventory')">
                    <i class="nav-icon inventory fas fa-boxes"></i>
                    <span>Inventario</span>
                </a>
                <a href="#" class="nav-item" onclick="navigateTo('sales')">
                    <i class="nav-icon sales fas fa-cash-register"></i>
                    <span>Ventas</span>
                </a>
                <a href="#" class="nav-item" onclick="navigateTo('customers')">
                    <i class="nav-icon customers fas fa-users"></i>
                    <span>Clientes</span>
                </a>
                <a href="#" class="nav-item" onclick="navigateTo('suppliers')">
                    <i class="nav-icon suppliers fas fa-truck"></i>
                    <span>Proveedores</span>
                </a>
                <a href="#" class="nav-item" onclick="navigateTo('reports')">
                    <i class="nav-icon reports fas fa-chart-bar"></i>
                    <span>Reportes</span>
                </a>
                <a href="#" class="nav-item" onclick="navigateTo('settings')">
                    <i class="nav-icon settings fas fa-cog"></i>
                    <span>Configuración</span>
                </a>
            </div>
        </div>

        <!-- Estadísticas Rápidas -->
        <div class="stats">
            <div class="stat-card">
                <div class="stat-icon products">
                    <i class="fas fa-boxes"></i>
                </div>
                <div class="stat-change positive">
                    <i class="fas fa-arrow-up"></i>
                    +12%
                </div>
                <div class="stat-number" id="totalProducts">245</div>
                <div class="stat-label">Productos en Stock</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon sales">
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="stat-change positive">
                    <i class="fas fa-arrow-up"></i>
                    +18%
                </div>
                <div class="stat-number" id="todaySales">12</div>
                <div class="stat-label">Ventas Hoy</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon customers">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-change positive">
                    <i class="fas fa-arrow-up"></i>
                    +8%
                </div>
                <div class="stat-number" id="totalCustomers">89</div>
                <div class="stat-label">Clientes Activos</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon stock">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="stat-change negative">
                    <i class="fas fa-arrow-down"></i>
                    -3%
                </div>
                <div class="stat-number" id="lowStock">8</div>
                <div class="stat-label">Stock Bajo</div>
            </div>
        </div>

        <!-- Dashboard Principal -->
        <div class="dashboard">
            <div class="main-dashboard">
                <!-- Gráfico de Ventas -->
                <div class="dashboard-card">
                    <div class="chart-title">
                        <i class="fas fa-chart-area" style="color: #4ecdc4;"></i>
                        Ventas del Mes
                    </div>
                    <div class="chart-subtitle">Tendencia de ventas diarias</div>
                    <div class="chart-container">
                        <canvas id="salesChart"></canvas>
                    </div>
                </div>

                <!-- Gráfico de Productos -->
                <div class="dashboard-card">
                    <div class="chart-title">
                        <i class="fas fa-chart-pie" style="color: #ff6b6b;"></i>
                        Categorías de Productos
                    </div>
                    <div class="chart-subtitle">Distribución por categoría</div>
                    <div class="chart-container">
                        <canvas id="categoryChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="sidebar-dashboard">
                <!-- Actividad Reciente -->
                <div class="dashboard-card">
                    <div class="chart-title">
                        <i class="fas fa-clock" style="color: #f9ca24;"></i>
                        Actividad Reciente
                    </div>
                    <div class="chart-subtitle">Últimas transacciones</div>
                    <div class="activity-feed">
                        <div class="activity-item">
                            <div class="activity-icon" style="background: linear-gradient(135deg, #4ecdc4, #44bd87);">
                                <i class="fas fa-shopping-cart"></i>
                            </div>
                            <div class="activity-content">
                                <div class="activity-title">Nueva venta realizada</div>
                                <div class="activity-time">Hace 5 minutos</div>
                            </div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-icon" style="background: linear-gradient(135deg, #ff6b6b, #ee5a24);">
                                <i class="fas fa-box"></i>
                            </div>
                            <div class="activity-content">
                                <div class="activity-title">Producto agregado al inventario</div>
                                <div class="activity-time">Hace 12 minutos</div>
                            </div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-icon" style="background: linear-gradient(135deg, #45b7d1, #96ceb4);">
                                <i class="fas fa-user-plus"></i>
                            </div>
                            <div class="activity-content">
                                <div class="activity-title">Nuevo cliente registrado</div>
                                <div class="activity-time">Hace 25 minutos</div>
                            </div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-icon" style="background: linear-gradient(135deg, #6c5ce7, #a29bfe);">
                                <i class="fas fa-cogs"></i>
                            </div>
                            <div class="activity-content">
                                <div class="activity-title">Configuración actualizada</div>
                                <div class="activity-time">Hace 1 hora</div>
                            </div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-icon" style="background: linear-gradient(135deg, #fd79a8, #fdcb6e);">
                                <i class="fas fa-truck"></i>
                            </div>
                            <div class="activity-content">
                                <div class="activity-title">Pedido a proveedor enviado</div>
                                <div class="activity-time">Hace 2 horas</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Top Products -->
                <div class="dashboard-card">
                    <div class="chart-title">
                        <i class="fas fa-star" style="color: #f9ca24;"></i>
                        Productos Top
                    </div>
                    <div class="chart-subtitle">Más vendidos esta semana</div>
                    <div class="top-products">
                        <div class="product-item">
                            <div class="product-rank">1</div>
                            <div class="product-info">
                                <div class="product-name">Auriculares Bluetooth</div>
                                <div class="product-sales">45 vendidos</div>
                            </div>
                            <div class="product-revenue">$2,250</div>
                        </div>
                        <div class="product-item">
                            <div class="product-rank">2</div>
                            <div class="product-info">
                                <div class="product-name">Cargador Inalámbrico</div>
                                <div class="product-sales">38 vendidos</div>
                            </div>
                            <div class="product-revenue">$1,900</div>
                        </div>
                        <div class="product-item">
                            <div class="product-rank">3</div>
                            <div class="product-info">
                                <div class="product-name">Funda para iPhone</div>
                                <div class="product-sales">32 vendidos</div>
                            </div>
                            <div class="product-revenue">$800</div>
                        </div>
                        <div class="product-item">
                            <div class="product-rank">4</div>
                            <div class="product-info">
                                <div class="product-name">Cable USB-C</div>
                                <div class="product-sales">28 vendidos</div>
                            </div>
                            <div class="product-revenue">$420</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
        <div class="footer">
            <p><strong>Acciones Rápidas</strong></p>
            <div class="quick-actions">
                <a href="#" class="quick-btn" onclick="quickAction('newSale')">
                    <i class="fas fa-plus"></i> Nueva Venta
                </a>
                <a href="#" class="quick-btn" onclick="quickAction('addProduct')">
                    <i class="fas fa-box"></i> Agregar Producto
                </a>
                <a href="#" class="quick-btn" onclick="quickAction('newCustomer')">
                    <i class="fas fa-user-plus"></i> Nuevo Cliente
                </a>
                <a href="#" class="quick-btn" onclick="quickAction('dailyReport')">
                    <i class="fas fa-file-alt"></i> Reporte Diario
                </a>
            </div>
            <p style="margin-top: 24px; color: rgba(255, 255, 255, 0.5); font-size: 0.9rem; font-weight: 400;">
                © 2025 AriStore - Sistema de Gestión de Accesorios | Versión 1.0
            </p>
        </div>

        <!-- Loading Overlay -->
        <div class="loading" id="loadingOverlay">
            <div class="spinner"></div>
            <p>Cargando...</p>
        </div>
    </div>

    <script>
        // Funciones de navegación
        function navigateTo(section) {
            showLoading();
            
            // Actualizar estado activo del menú
            updateActiveNav(section);
            
            // Simular carga y redirigir
            setTimeout(() => {
                hideLoading();
                if (section === 'dashboard') {
                    // Permanecer en dashboard
                    console.log('Navegando al Dashboard Principal');
                } else if (section === 'inventory') {
                    // Redirigir a la página de inventario
                    window.location.href = 'inventario.html';
                } else if (section === 'sales') {
                    // Redirigir a la página de ventas
                    window.location.href = 'ventas.html';
                } else if (section === 'customers') {
                    // Redirigir a la página de clientes
                    window.location.href = 'clientes.html';
                } else if (section === 'suppliers') {
                    // Redirigir a la página de proveedores
                    window.location.href = 'proveedores.html';
                } else if (section === 'reports') {
                    // Redirigir a la página de reportes
                    window.location.href = 'reportes.html';
                } else if (section === 'settings') {
                    // Redirigir a la página de configuración
                    window.location.href = 'configuracion.html';
                } else {
                    alert(`Navegando a: ${section.toUpperCase()}\n\nEsta función se implementará en las siguientes páginas del sistema.`);
                }
            }, 1000);
        }

        // Actualizar navegación activa
        function updateActiveNav(activeSection) {
            // Remover clase active de todos los items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Agregar clase active al item correspondiente
            const activeItem = document.querySelector(`[onclick="navigateTo('${activeSection}')"]`);
            if (activeItem) {
                activeItem.classList.add('active');
            }
        }

        function quickAction(action) {
            showLoading();
            
            setTimeout(() => {
                hideLoading();
                switch(action) {
                    case 'newSale':
                        // Redireccionar directamente al módulo de ventas
                        window.location.href = 'ventas.html';
                        break;
                    case 'addProduct':
                        // Redireccionar al módulo de inventario
                        window.location.href = 'inventario.html';
                        break;
                    case 'newCustomer':
                        // Redireccionar al módulo de clientes
                        window.location.href = 'clientes.html';
                        break;
                    case 'dailyReport':
                        generateDailyReport();
                        break;
                }
            }, 800);
        }

        // Generar reporte diario
        function generateDailyReport() {
            // Obtener datos de localStorage
            const products = JSON.parse(localStorage.getItem('aristore_products') || '[]');
            const sales = JSON.parse(localStorage.getItem('aristore_sales') || '[]');
            const clients = JSON.parse(localStorage.getItem('aristore_clients') || '[]');
            
            // Filtrar ventas de hoy
            const today = new Date().toDateString();
            const todaySales = sales.filter(sale => 
                new Date(sale.date).toDateString() === today
            );

            // Calcular estadísticas
            const totalSales = todaySales.length;
            const totalRevenue = todaySales.reduce((sum, sale) => sum + sale.total, 0);
            const averageSale = totalSales > 0 ? totalRevenue / totalSales : 0;
            const lowStockProducts = products.filter(p => p.stock <= 5).length;

            // Crear ventana de reporte
            const reportWindow = window.open('', 'ReporteDiario', 'width=800,height=600');
            
            const reportHTML = `
                <!DOCTYPE html>
                <html lang="es">
                <head>
                    <meta charset="UTF-8">
                    <title>AriStore - Reporte Diario</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; color: #333; }
                        .header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #4ecdc4; padding-bottom: 20px; }
                        .logo { font-size: 2rem; font-weight: bold; color: #4ecdc4; }
                        .stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
                        .stat-card { background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center; border-left: 4px solid #4ecdc4; }
                        .stat-number { font-size: 1.8rem; font-weight: bold; color: #4ecdc4; }
                        .stat-label { color: #666; font-size: 0.9rem; }
                        .section { margin-bottom: 30px; }
                        .section-title { font-size: 1.2rem; font-weight: bold; color: #333; margin-bottom: 15px; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
                        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
                        th, td { padding: 8px; text-align: left; border-bottom: 1px solid #ddd; }
                        th { background-color: #4ecdc4; color: white; }
                        .alert { background: #fff3cd; border: 1px solid #ffeaa7; padding: 10px; border-radius: 5px; margin: 10px 0; }
                        .print-btn { background: #4ecdc4; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 20px 0; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <div class="logo">🛍️ AriStore</div>
                        <h2>Reporte Diario de Operaciones</h2>
                        <p>Fecha: ${new Date().toLocaleDateString('es-ES', { 
                            year: 'numeric', month: 'long', day: 'numeric'
                        })}</p>
                    </div>
                    
                    <div class="stats">
                        <div class="stat-card">
                            <div class="stat-number">${totalSales}</div>
                            <div class="stat-label">Ventas Realizadas</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">$${totalRevenue.toFixed(2)}</div>
                            <div class="stat-label">Ingresos del Día</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">$${averageSale.toFixed(2)}</div>
                            <div class="stat-label">Venta Promedio</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${products.length}</div>
                            <div class="stat-label">Productos Activos</div>
                        </div>
                    </div>

                    ${lowStockProducts > 0 ? `
                        <div class="alert">
                            <strong>⚠️ Alerta:</strong> Tienes ${lowStockProducts} productos con stock bajo que requieren reposición.
                        </div>
                    ` : ''}

                    <div class="section">
                        <div class="section-title">Ventas del Día</div>
                        ${totalSales > 0 ? `
                            <table>
                                <thead>
                                    <tr>
                                        <th>ID Venta</th>
                                        <th>Cliente</th>
                                        <th>Hora</th>
                                        <th>Items</th>
                                        <th>Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${todaySales.map(sale => `
                                        <tr>
                                            <td>${sale.id}</td>
                                            <td>${sale.customer}</td>
                                            <td>${new Date(sale.date).toLocaleTimeString('es-ES')}</td>
                                            <td>${sale.items.length}</td>
                                            <td>$${sale.total.toFixed(2)}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        ` : '<p>No se realizaron ventas hoy.</p>'}
                    </div>

                    <div class="section">
                        <div class="section-title">Resumen de Inventario</div>
                        <p><strong>Total de productos:</strong> ${products.length}</p>
                        <p><strong>Productos con stock bajo:</strong> ${lowStockProducts}</p>
                        <p><strong>Productos sin stock:</strong> ${products.filter(p => p.stock === 0).length}</p>
                    </div>

                    <div class="section">
                        <div class="section-title">Base de Clientes</div>
                        <p><strong>Total de clientes:</strong> ${clients.length}</p>
                        <p><strong>Clientes activos:</strong> ${clients.filter(c => c.status === 'activo' || c.status === 'vip').length}</p>
                        <p><strong>Clientes VIP:</strong> ${clients.filter(c => c.status === 'vip').length}</p>
                    </div>

                    <button class="print-btn" onclick="window.print()">🖨️ Imprimir Reporte</button>
                    
                    <div style="text-align: center; margin-top: 30px; color: #666; font-size: 0.9rem;">
                        <p>AriStore - Sistema de Gestión | Reporte generado automáticamente</p>
                    </div>
                </body>
                </html>
            `;
            
            reportWindow.document.write(reportHTML);
            reportWindow.document.close();
        }

        function showLoading() {
            const loading = document.getElementById('loadingOverlay');
            loading.classList.add('show');
        }

        function hideLoading() {
            const loading = document.getElementById('loadingOverlay');
            loading.classList.remove('show');
        }

        // Actualizar estadísticas (con datos reales)
        function updateStats() {
            // Obtener datos de localStorage
            const products = JSON.parse(localStorage.getItem('aristore_products') || '[]');
            const sales = JSON.parse(localStorage.getItem('aristore_sales') || '[]');
            const clients = JSON.parse(localStorage.getItem('aristore_clients') || '[]');
            
            // Calcular estadísticas reales
            const today = new Date().toDateString();
            const todaySales = sales.filter(sale => 
                new Date(sale.date).toDateString() === today
            );
            
            const stats = {
                totalProducts: products.length,
                todaySales: todaySales.length,
                totalCustomers: clients.filter(c => c.status === 'activo' || c.status === 'vip' || c.status === 'regular').length,
                lowStock: products.filter(p => p.stock <= 5).length
            };

            // Actualizar elementos en la página con animación
            Object.keys(stats).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    const currentValue = parseInt(element.textContent) || 0;
                    const newValue = stats[key];
                    
                    // Animación de contador
                    if (currentValue !== newValue) {
                        animateCounter(element, currentValue, newValue, 1000);
                    }
                }
            });

            // Actualizar también los productos más vendidos
            updateTopProducts();
            
            // Actualizar actividad reciente
            updateRecentActivity();
        }

        // Animación de contador
        function animateCounter(element, start, end, duration) {
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                const current = Math.floor(progress * (end - start) + start);
                element.textContent = current;
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        }

        // Actualizar productos más vendidos con datos reales
        function updateTopProducts() {
            const sales = JSON.parse(localStorage.getItem('aristore_sales') || '[]');
            const productSales = {};
            
            // Contar ventas por producto
            sales.forEach(sale => {
                if (sale.items && Array.isArray(sale.items)) {
                    sale.items.forEach(item => {
                        const productName = item.name || item.product;
                        if (productName) {
                            if (productSales[productName]) {
                                productSales[productName].quantity += item.quantity || 1;
                                productSales[productName].revenue += (item.price || 0) * (item.quantity || 1);
                            } else {
                                productSales[productName] = {
                                    quantity: item.quantity || 1,
                                    revenue: (item.price || 0) * (item.quantity || 1)
                                };
                            }
                        }
                    });
                }
            });
            
            // Ordenar por cantidad vendida
            const sortedProducts = Object.entries(productSales)
                .sort((a, b) => b[1].quantity - a[1].quantity)
                .slice(0, 4);
                
            // Actualizar la lista de productos top
            const topProductsContainer = document.querySelector('.top-products');
            if (sortedProducts.length > 0) {
                topProductsContainer.innerHTML = sortedProducts.map((product, index) => `
                    <div class="product-item">
                        <div class="product-rank">${index + 1}</div>
                        <div class="product-info">
                            <div class="product-name">${product[0]}</div>
                            <div class="product-sales">${product[1].quantity} vendidos</div>
                        </div>
                        <div class="product-revenue">$${product[1].revenue.toFixed(2)}</div>
                    </div>
                `).join('');
            } else {
                topProductsContainer.innerHTML = `
                    <div class="product-item" style="justify-content: center; text-align: center; color: rgba(255, 255, 255, 0.6);">
                        <div style="padding: 20px;">
                            <i class="fas fa-chart-bar" style="font-size: 2rem; margin-bottom: 10px; opacity: 0.5;"></i>
                            <div>No hay datos de ventas disponibles</div>
                            <div style="font-size: 0.8rem; margin-top: 5px;">Realiza algunas ventas para ver los productos más populares</div>
                        </div>
                    </div>
                `;
            }
        }

        // Actualizar actividad reciente con datos reales
        function updateRecentActivity() {
            const sales = JSON.parse(localStorage.getItem('aristore_sales') || '[]');
            const products = JSON.parse(localStorage.getItem('aristore_products') || '[]');
            const clients = JSON.parse(localStorage.getItem('aristore_clients') || '[]');
            
            // Crear array de actividades recientes
            let activities = [];
            
            // Agregar ventas recientes
            sales.slice(-3).reverse().forEach(sale => {
                activities.push({
                    type: 'sale',
                    title: 'Nueva venta realizada',
                    subtitle: `Venta ${sale.id} - $${sale.total.toFixed(2)}`,
                    time: getTimeAgo(new Date(sale.date)),
                    icon: 'fas fa-shopping-cart',
                    color: 'linear-gradient(135deg, #4ecdc4, #44bd87)'
                });
            });
            
            // Agregar productos recientes
            products.slice(-2).reverse().forEach(product => {
                activities.push({
                    type: 'product',
                    title: 'Producto agregado al inventario',
                    subtitle: product.name,
                    time: getTimeAgo(new Date(product.dateAdded || Date.now())),
                    icon: 'fas fa-box',
                    color: 'linear-gradient(135deg, #ff6b6b, #ee5a24)'
                });
            });
            
            // Agregar clientes recientes
            clients.slice(-1).reverse().forEach(client => {
                activities.push({
                    type: 'client',
                    title: 'Nuevo cliente registrado',
                    subtitle: client.name,
                    time: getTimeAgo(new Date(client.dateAdded || Date.now())),
                    icon: 'fas fa-user-plus',
                    color: 'linear-gradient(135deg, #45b7d1, #96ceb4)'
                });
            });
            
            // Ordenar por tiempo (más reciente primero)
            activities.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            // Limitar a 5 actividades
            activities = activities.slice(0, 5);
            
            // Actualizar el feed de actividad
            const activityFeed = document.querySelector('.activity-feed');
            if (activities.length > 0) {
                activityFeed.innerHTML = activities.map(activity => `
                    <div class="activity-item">
                        <div class="activity-icon" style="background: ${activity.color};">
                            <i class="${activity.icon}"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">${activity.title}</div>
                            <div class="activity-subtitle" style="color: rgba(255, 255, 255, 0.6); font-size: 0.8rem; margin: 2px 0;">${activity.subtitle}</div>
                            <div class="activity-time">${activity.time}</div>
                        </div>
                    </div>
                `).join('');
            } else {
                activityFeed.innerHTML = `
                    <div class="activity-item" style="justify-content: center; text-align: center;">
                        <div style="padding: 20px; color: rgba(255, 255, 255, 0.6);">
                            <i class="fas fa-clock" style="font-size: 2rem; margin-bottom: 10px; opacity: 0.5;"></i>
                            <div>No hay actividad reciente</div>
                            <div style="font-size: 0.8rem; margin-top: 5px;">Las actividades aparecerán aquí cuando uses el sistema</div>
                        </div>
                    </div>
                `;
            }
        }

        // Función para calcular tiempo transcurrido
        function getTimeAgo(date) {
            const now = new Date();
            const diffInMinutes = Math.floor((now - date) / (1000 * 60));
            
            if (diffInMinutes < 1) return 'Hace un momento';
            if (diffInMinutes < 60) return `Hace ${diffInMinutes} minuto${diffInMinutes > 1 ? 's' : ''}`;
            
            const diffInHours = Math.floor(diffInMinutes / 60);
            if (diffInHours < 24) return `Hace ${diffInHours} hora${diffInHours > 1 ? 's' : ''}`;
            
            const diffInDays = Math.floor(diffInHours / 24);
            if (diffInDays < 7) return `Hace ${diffInDays} día${diffInDays > 1 ? 's' : ''}`;
            
            return date.toLocaleDateString('es-ES');
        }

        // Inicializar la página
        document.addEventListener('DOMContentLoaded', function() {
            // Cargar estadísticas reales al inicio
            updateStats();
            
            // Inicializar gráficos con datos reales
            initCharts();
            
            // Actualizar estadísticas cada 30 segundos
            setInterval(() => {
                updateStats();
                updateCharts();
            }, 30000);
            
            // Mostrar mensaje de bienvenida
            setTimeout(() => {
                console.log('AriStore System v2.1.0 - Sistema de Gestión Empresarial');
                console.log('Dashboard conectado con módulos: Inventario, Ventas, Clientes, Proveedores, Reportes y Configuración');
                console.log('Datos en tiempo real desde localStorage');
            }, 1000);

            // Generar datos de ejemplo si no existen
            generateSampleDataIfEmpty();
        });

        // Generar datos de ejemplo si no existen
        function generateSampleDataIfEmpty() {
            // Verificar si hay datos existentes
            const products = JSON.parse(localStorage.getItem('aristore_products') || '[]');
            const sales = JSON.parse(localStorage.getItem('aristore_sales') || '[]');
            const clients = JSON.parse(localStorage.getItem('aristore_clients') || '[]');

            // Si no hay productos, crear algunos de ejemplo
            if (products.length === 0) {
                const sampleProducts = [
                    {
                        id: 'PROD-001',
                        name: 'Auriculares Bluetooth Premium',
                        category: 'Auriculares',
                        stock: 25,
                        buyPrice: 45.00,
                        salePrice: 79.99,
                        margin: 43.75,
                        supplier: 'TechSupply Co.',
                        dateAdded: new Date().toISOString()
                    },
                    {
                        id: 'PROD-002',
                        name: 'Cargador Inalámbrico Rápido',
                        category: 'Cargadores',
                        stock: 15,
                        buyPrice: 25.00,
                        salePrice: 49.99,
                        margin: 49.98,
                        supplier: 'ElectroMax',
                        dateAdded: new Date(Date.now() - 86400000).toISOString()
                    },
                    {
                        id: 'PROD-003',
                        name: 'Funda Transparente iPhone',
                        category: 'Fundas',
                        stock: 3,
                        buyPrice: 8.00,
                        salePrice: 19.99,
                        margin: 59.98,
                        supplier: 'AccessoriesPlus',
                        dateAdded: new Date(Date.now() - 172800000).toISOString()
                    },
                    {
                        id: 'PROD-004',
                        name: 'Cable USB-C Premium',
                        category: 'Cables',
                        stock: 0,
                        buyPrice: 5.00,
                        salePrice: 14.99,
                        margin: 66.64,
                        supplier: 'CableTech',
                        dateAdded: new Date(Date.now() - 259200000).toISOString()
                    },
                    {
                        id: 'PROD-005',
                        name: 'Smartwatch Deportivo',
                        category: 'Smartwatches',
                        stock: 8,
                        buyPrice: 120.00,
                        salePrice: 199.99,
                        margin: 39.99,
                        supplier: 'WearableTech',
                        dateAdded: new Date(Date.now() - 345600000).toISOString()
                    }
                ];
                localStorage.setItem('aristore_products', JSON.stringify(sampleProducts));
            }

            // Si no hay clientes, crear algunos de ejemplo
            if (clients.length === 0) {
                const sampleClients = [
                    {
                        id: 'CLI-001',
                        name: 'Juan Pérez García',
                        email: 'juan.perez@email.com',
                        phone: '+52 55 1234-5678',
                        city: 'Ciudad de México',
                        status: 'vip',
                        totalPurchases: 8,
                        totalSpent: 650.45,
                        dateAdded: new Date(Date.now() - 2592000000).toISOString(),
                        lastPurchase: new Date(Date.now() - 86400000).toISOString()
                    },
                    {
                        id: 'CLI-002',
                        name: 'María González López',
                        email: 'maria.gonzalez@email.com',
                        phone: '+52 55 9876-5432',
                        city: 'Guadalajara',
                        status: 'regular',
                        totalPurchases: 3,
                        totalSpent: 245.97,
                        dateAdded: new Date(Date.now() - 1728000000).toISOString(),
                        lastPurchase: new Date(Date.now() - 172800000).toISOString()
                    },
                    {
                        id: 'CLI-003',
                        name: 'Carlos Rodríguez Martín',
                        email: 'carlos.rodriguez@email.com',
                        phone: '+52 81 5555-1234',
                        city: 'Monterrey',
                        status: 'activo',
                        totalPurchases: 1,
                        totalSpent: 79.99,
                        dateAdded: new Date(Date.now() - 604800000).toISOString(),
                        lastPurchase: new Date(Date.now() - 604800000).toISOString()
                    }
                ];
                localStorage.setItem('aristore_clients', JSON.stringify(sampleClients));
            }

            // Si no hay ventas, crear algunas de ejemplo
            if (sales.length === 0) {
                const sampleSales = [
                    {
                        id: 'SALE-001',
                        date: new Date().toISOString(),
                        customer: 'Juan Pérez García',
                        paymentMethod: 'Tarjeta',
                        items: [
                            {
                                name: 'Auriculares Bluetooth Premium',
                                quantity: 1,
                                price: 79.99
                            }
                        ],
                        subtotal: 79.99,
                        tax: 12.80,
                        total: 92.79
                    },
                    {
                        id: 'SALE-002',
                        date: new Date(Date.now() - 86400000).toISOString(),
                        customer: 'María González López',
                        paymentMethod: 'Efectivo',
                        items: [
                            {
                                name: 'Cargador Inalámbrico Rápido',
                                quantity: 1,
                                price: 49.99
                            },
                            {
                                name: 'Funda Transparente iPhone',
                                quantity: 2,
                                price: 19.99
                            }
                        ],
                        subtotal: 89.97,
                        tax: 14.40,
                        total: 104.37
                    },
                    {
                        id: 'SALE-003',
                        date: new Date(Date.now() - 172800000).toISOString(),
                        customer: 'Carlos Rodríguez Martín',
                        paymentMethod: 'Transferencia',
                        items: [
                            {
                                name: 'Smartwatch Deportivo',
                                quantity: 1,
                                price: 199.99
                            }
                        ],
                        subtotal: 199.99,
                        tax: 32.00,
                        total: 231.99
                    }
                ];
                localStorage.setItem('aristore_sales', JSON.stringify(sampleSales));
            }

            // Actualizar dashboard con los nuevos datos
            setTimeout(() => {
                updateStats();
                updateCharts();
            }, 500);
        }

        // Variables globales para los gráficos
        let salesChart, categoryChart;

        // Inicializar gráficos con datos reales
        function initCharts() {
            initSalesChart();
            initCategoryChart();
        }

        // Gráfico de Ventas con datos reales
        function initSalesChart() {
            const salesCtx = document.getElementById('salesChart').getContext('2d');
            const sales = JSON.parse(localStorage.getItem('aristore_sales') || '[]');
            
            // Procesar datos de ventas por día de la semana
            const salesByDay = processWeeklySales(sales);
            
            salesChart = new Chart(salesCtx, {
                type: 'line',
                data: {
                    labels: ['Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb', 'Dom'],
                    datasets: [{
                        label: 'Ventas',
                        data: salesByDay,
                        borderColor: '#4ecdc4',
                        backgroundColor: 'rgba(78, 205, 196, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#4ecdc4',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 6,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)',
                                borderColor: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)',
                                font: {
                                    family: 'Inter'
                                },
                                callback: function(value) {
                                    return '$' + value.toFixed(0);
                                }
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)',
                                borderColor: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)',
                                font: {
                                    family: 'Inter'
                                }
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }

        // Gráfico de Categorías con datos reales
        function initCategoryChart() {
            const categoryCtx = document.getElementById('categoryChart').getContext('2d');
            const products = JSON.parse(localStorage.getItem('aristore_products') || '[]');
            
            // Procesar datos de categorías
            const categoryData = processCategoryData(products);
            
            categoryChart = new Chart(categoryCtx, {
                type: 'doughnut',
                data: {
                    labels: categoryData.labels,
                    datasets: [{
                        data: categoryData.data,
                        backgroundColor: [
                            '#ff6b6b',
                            '#4ecdc4',
                            '#45b7d1',
                            '#f9ca24',
                            '#6c5ce7',
                            '#fd79a8'
                        ],
                        borderWidth: 0,
                        hoverOffset: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: 'rgba(255, 255, 255, 0.8)',
                                font: {
                                    family: 'Inter',
                                    size: 12
                                },
                                padding: 20,
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        }
                    },
                    cutout: '60%'
                }
            });
        }

        // Procesar datos de ventas por día de la semana
        function processWeeklySales(sales) {
            const weeklyData = [0, 0, 0, 0, 0, 0, 0]; // Lun-Dom
            const today = new Date();
            const lastWeek = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
            
            sales.forEach(sale => {
                const saleDate = new Date(sale.date);
                if (saleDate >= lastWeek && saleDate <= today) {
                    const dayOfWeek = saleDate.getDay();
                    const adjustedDay = dayOfWeek === 0 ? 6 : dayOfWeek - 1; // Ajustar para Lun=0
                    weeklyData[adjustedDay] += sale.total;
                }
            });
            
            return weeklyData;
        }

        // Procesar datos de categorías
        function processCategoryData(products) {
            const categoryCount = {};
            
            if (products.length === 0) {
                return {
                    labels: ['Sin datos'],
                    data: [1]
                };
            }
            
            products.forEach(product => {
                const category = product.category || 'Sin categoría';
                categoryCount[category] = (categoryCount[category] || 0) + 1;
            });
            
            return {
                labels: Object.keys(categoryCount),
                data: Object.values(categoryCount)
            };
        }

        // Actualizar gráficos con nuevos datos
        function updateCharts() {
            if (salesChart) {
                const sales = JSON.parse(localStorage.getItem('aristore_sales') || '[]');
                const salesByDay = processWeeklySales(sales);
                salesChart.data.datasets[0].data = salesByDay;
                salesChart.update();
            }
            
            if (categoryChart) {
                const products = JSON.parse(localStorage.getItem('aristore_products') || '[]');
                const categoryData = processCategoryData(products);
                categoryChart.data.labels = categoryData.labels;
                categoryChart.data.datasets[0].data = categoryData.data;
                categoryChart.update();
            }
        }

        // Manejo de errores de imágenes
        document.addEventListener('DOMContentLoaded', function() {
            const logo = document.querySelector('.logo');
            logo.onerror = function() {
                this.style.display = 'none';
            };
        });
    </script>

    <!-- Firebase Configuration -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-analytics.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyCzsn9shEOuhQ1ez2_xzRsHHUPXUZeCyyo",
            authDomain: "arisoft-49e7c.firebaseapp.com",
            projectId: "arisoft-49e7c",
            storageBucket: "arisoft-49e7c.firebasestorage.app",
            messagingSenderId: "128011827798",
            appId: "1:128011827798:web:49da366cc846a6e40959f7",
            measurementId: "G-MQ58NER7Q6"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        
        console.log('Firebase Analytics inicializado correctamente para AriStore');
    </script>
</body>
</html>