<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nómina - AriStore ERP</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; color: #333; }
        .app-layout { display: flex; min-height: 100vh; }
        
        /* Sidebar (compacto) */
        .sidebar { width: 280px; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-right: 1px solid rgba(255, 255, 255, 0.2); box-shadow: 2px 0 20px rgba(0, 0, 0, 0.1); position: fixed; height: 100vh; left: 0; top: 0; z-index: 1000; overflow-y: auto; }
        .sidebar-header { padding: 24px 20px; border-bottom: 1px solid rgba(0, 0, 0, 0.1); background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); }
        .sidebar-logo { display: flex; align-items: center; text-decoration: none; color: white; font-weight: 700; font-size: 20px; }
        .sidebar-logo img { width: 40px; height: 40px; margin-right: 12px; border-radius: 8px; }
        .sidebar-nav { padding: 20px 0; }
        .nav-section { margin-bottom: 32px; }
        .nav-section-title { padding: 0 20px 12px; font-size: 12px; font-weight: 600; text-transform: uppercase; color: #64748b; letter-spacing: 0.5px; }
        .nav-item { display: flex; align-items: center; padding: 12px 20px; text-decoration: none; color: #475569; font-weight: 500; transition: all 0.3s ease; position: relative; }
        .nav-item:hover { background: rgba(102, 126, 234, 0.1); color: #4f46e5; transform: translateX(4px); }
        .nav-item.active { background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%); color: white; font-weight: 600; }
        .nav-item.active::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 4px; background: #fbbf24; border-radius: 0 4px 4px 0; }
        .nav-item i { width: 20px; margin-right: 12px; font-size: 16px; }

        /* Main Content */
        .main-content { flex: 1; margin-left: 280px; padding: 32px; background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); min-height: 100vh; }
        .page-header { background: rgba(255, 255, 255, 0.95); padding: 32px; border-radius: 16px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); margin-bottom: 32px; border: 1px solid rgba(255, 255, 255, 0.2); }
        .page-title { font-size: 32px; font-weight: 700; color: #1e293b; margin-bottom: 8px; }
        .page-subtitle { color: #64748b; font-size: 16px; }
        .content-card { background: rgba(255, 255, 255, 0.95); border-radius: 16px; padding: 32px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); margin-bottom: 24px; }
        
        .btn { padding: 12px 24px; border-radius: 8px; border: none; font-weight: 600; text-decoration: none; display: inline-flex; align-items: center; gap: 8px; cursor: pointer; transition: all 0.3s ease; font-size: 14px; }
        .btn-primary { background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%); color: white; }
        .btn-secondary { background: rgba(100, 116, 139, 0.1); color: #475569; border: 1px solid rgba(100, 116, 139, 0.2); }
        .btn-success { background: linear-gradient(135deg, #059669 0%, #10b981 100%); color: white; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 24px; margin-bottom: 32px; }
        .stat-card { background: rgba(255, 255, 255, 0.95); padding: 24px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); }
        .stat-value { font-size: 32px; font-weight: 700; color: #1e293b; margin-bottom: 8px; }
        .stat-label { color: #64748b; font-size: 14px; }
        
        .table-container { overflow-x: auto; border-radius: 12px; border: 1px solid rgba(0, 0, 0, 0.1); }
        .table { width: 100%; border-collapse: collapse; background: white; }
        .table th { background: #f8fafc; padding: 16px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb; }
        .table td { padding: 16px; border-bottom: 1px solid #f3f4f6; }
        .table tr:hover { background: #f9fafb; }
        
        .toolbar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
        
        /* Responsive */
        @media (max-width: 768px) {
            .sidebar { transform: translateX(-100%); transition: transform 0.3s ease; }
            .sidebar.open { transform: translateX(0); }
            .main-content { margin-left: 0; padding: 16px; }
        }
    </style>
</head>
<body>
    <div class="app-layout">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="index.html" class="sidebar-logo">
                    <img src="logos/aristore.png" alt="AriStore Logo">
                    <span>AriStore ERP</span>
                </a>
            </div>
            
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Principal</div>
                    <a href="index.html" class="nav-item"><i class="fas fa-tachometer-alt"></i><span>Dashboard</span></a>
                    <a href="analytics.html" class="nav-item"><i class="fas fa-chart-line"></i><span>Análisis</span></a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Gestión</div>
                    <a href="ventas.html" class="nav-item"><i class="fas fa-shopping-cart"></i><span>Ventas</span></a>
                    <a href="inventario.html" class="nav-item"><i class="fas fa-boxes"></i><span>Inventario</span></a>
                    <a href="clientes.html" class="nav-item"><i class="fas fa-users"></i><span>Clientes</span></a>
                    <a href="proveedores.html" class="nav-item"><i class="fas fa-truck"></i><span>Proveedores</span></a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Finanzas</div>
                    <a href="contabilidad.html" class="nav-item"><i class="fas fa-calculator"></i><span>Contabilidad</span></a>
                    <a href="facturacion.html" class="nav-item"><i class="fas fa-file-invoice"></i><span>Facturación</span></a>
                    <a href="reportes.html" class="nav-item"><i class="fas fa-chart-pie"></i><span>Reportes</span></a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">RRHH</div>
                    <a href="empleados.html" class="nav-item"><i class="fas fa-user-tie"></i><span>Empleados</span></a>
                    <a href="nomina.html" class="nav-item active"><i class="fas fa-money-check-alt"></i><span>Nómina</span></a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Sistema</div>
                    <a href="configuracion.html" class="nav-item"><i class="fas fa-cog"></i><span>Configuración</span></a>
                    <a href="usuarios.html" class="nav-item"><i class="fas fa-users-cog"></i><span>Usuarios</span></a>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="page-header">
                <h1 class="page-title"><i class="fas fa-money-check-alt"></i> Gestión de Nómina</h1>
                <p class="page-subtitle">Procesa y gestiona los pagos de nómina</p>
            </div>

            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card"><div class="stat-value" id="totalNomina">$0</div><div class="stat-label">Total Nómina Mensual</div></div>
                <div class="stat-card"><div class="stat-value" id="empleadosPagados">0</div><div class="stat-label">Empleados Pagados</div></div>
                <div class="stat-card"><div class="stat-value" id="totalDeducciones">$0</div><div class="stat-label">Total Deducciones</div></div>
                <div class="stat-card"><div class="stat-value" id="totalBonos">$0</div><div class="stat-label">Total Bonos</div></div>
            </div>

            <!-- Content Card -->
            <div class="content-card">
                <div class="toolbar">
                    <h3>Nómina del Mes: <span id="mesActual"></span></h3>
                    <div>
                        <button class="btn btn-success" onclick="procesarNomina()"><i class="fas fa-calculator"></i> Procesar Nómina</button>
                        <button class="btn btn-primary" onclick="generarRecibos()"><i class="fas fa-file-alt"></i> Generar Recibos</button>
                    </div>
                </div>

                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Empleado</th><th>Salario Base</th><th>Bonos</th><th>Deducciones</th><th>Total Neto</th><th>Estado</th><th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="nominaTableBody">
                            <!-- La nómina se cargará dinámicamente -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Historial de Nóminas -->
            <div class="content-card">
                <h3 style="margin-bottom: 24px;">Historial de Nóminas</h3>
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Mes/Año</th><th>Total Procesado</th><th>Empleados</th><th>Fecha Proceso</th><th>Estado</th><th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="historialNominaBody">
                            <!-- El historial se cargará dinámicamente -->
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <script>
        let empleados = JSON.parse(localStorage.getItem('aristore_empleados')) || [];
        let nominas = JSON.parse(localStorage.getItem('aristore_nominas')) || [];

        document.addEventListener('DOMContentLoaded', function() {
            updateMesActual();
            loadNomina();
            updateStats();
            loadHistorial();
        });

        function updateMesActual() {
            const fecha = new Date();
            const meses = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
            document.getElementById('mesActual').textContent = `${meses[fecha.getMonth()]} ${fecha.getFullYear()}`;
        }

        function loadNomina() {
            const tbody = document.getElementById('nominaTableBody');
            tbody.innerHTML = '';
            
            const empleadosActivos = empleados.filter(e => e.estado === 'activo');
            
            empleadosActivos.forEach(empleado => {
                const bonos = 0; // Se puede calcular dinámicamente
                const deducciones = empleado.salario * 0.1; // 10% de deducciones como ejemplo
                const totalNeto = empleado.salario + bonos - deducciones;
                
                const row = `
                    <tr>
                        <td>${empleado.nombre}</td>
                        <td>$${empleado.salario.toLocaleString()}</td>
                        <td>$${bonos.toLocaleString()}</td>
                        <td>$${deducciones.toLocaleString()}</td>
                        <td>$${totalNeto.toLocaleString()}</td>
                        <td>
                            <span style="padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; background: #fef3c7; color: #d97706;">
                                Pendiente
                            </span>
                        </td>
                        <td>
                            <button class="btn btn-secondary" style="padding: 8px 12px;" onclick="verDetalle(${empleado.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        function updateStats() {
            const empleadosActivos = empleados.filter(e => e.estado === 'activo');
            const totalNomina = empleadosActivos.reduce((sum, e) => sum + e.salario, 0);
            const totalDeducciones = totalNomina * 0.1;
            const totalBonos = 0;

            document.getElementById('totalNomina').textContent = `$${totalNomina.toLocaleString()}`;
            document.getElementById('empleadosPagados').textContent = '0'; // Pendientes de pagar
            document.getElementById('totalDeducciones').textContent = `$${totalDeducciones.toLocaleString()}`;
            document.getElementById('totalBonos').textContent = `$${totalBonos.toLocaleString()}`;
        }

        function loadHistorial() {
            const tbody = document.getElementById('historialNominaBody');
            tbody.innerHTML = '';
            
            nominas.forEach(nomina => {
                const row = `
                    <tr>
                        <td>${nomina.mes}/${nomina.año}</td>
                        <td>$${nomina.total.toLocaleString()}</td>
                        <td>${nomina.empleados}</td>
                        <td>${new Date(nomina.fechaProceso).toLocaleDateString()}</td>
                        <td>
                            <span style="padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; background: #dcfce7; color: #16a34a;">
                                Procesado
                            </span>
                        </td>
                        <td>
                            <button class="btn btn-secondary" style="padding: 8px 12px;" onclick="verHistorial('${nomina.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        function procesarNomina() {
            if (confirm('¿Procesar la nómina del mes actual? Esta acción no se puede deshacer.')) {
                const fecha = new Date();
                const empleadosActivos = empleados.filter(e => e.estado === 'activo');
                const totalNomina = empleadosActivos.reduce((sum, e) => sum + e.salario, 0);
                
                const nuevaNomina = {
                    id: Date.now().toString(),
                    mes: fecha.getMonth() + 1,
                    año: fecha.getFullYear(),
                    total: totalNomina,
                    empleados: empleadosActivos.length,
                    fechaProceso: new Date().toISOString(),
                    estado: 'procesado'
                };
                
                nominas.push(nuevaNomina);
                localStorage.setItem('aristore_nominas', JSON.stringify(nominas));
                
                loadHistorial();
                alert('Nómina procesada exitosamente');
            }
        }

        function generarRecibos() {
            alert('Generando recibos de nómina...');
        }

        function verDetalle(empleadoId) {
            const empleado = empleados.find(e => e.id === empleadoId);
            if (empleado) {
                alert(`Detalle de nómina para: ${empleado.nombre}\nSalario: $${empleado.salario.toLocaleString()}`);
            }
        }

        function verHistorial(nominaId) {
            const nomina = nominas.find(n => n.id === nominaId);
            if (nomina) {
                alert(`Nómina ${nomina.mes}/${nomina.año}\nTotal: $${nomina.total.toLocaleString()}\nEmpleados: ${nomina.empleados}`);
            }
        }
    </script>
</body>
</html>
